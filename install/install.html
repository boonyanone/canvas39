<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Monitor v2.0 - Installation Wizard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2671ae;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--gray-800);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: var(--primary-color);
            color: white;
            text-align: center;
            padding: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.2);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.5s ease;
        }

        .step-content {
            padding: 3rem;
            min-height: 500px;
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .step-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--gray-900);
        }

        .step-description {
            font-size: 1.1rem;
            color: var(--gray-600);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--gray-800);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-input.error {
            border-color: var(--error-color);
        }

        .form-input.success {
            border-color: var(--success-color);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }

        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            margin: 0.5rem 0;
            display: none;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .status-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .requirements-list {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .requirement-item:last-child {
            border-bottom: none;
        }

        .requirement-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .requirement-status.checking {
            background: var(--gray-200);
            color: var(--gray-600);
        }

        .requirement-status.success {
            background: var(--success-color);
            color: white;
        }

        .requirement-status.error {
            background: var(--error-color);
            color: white;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 3rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1e5a96;
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
            gap: 0.5rem;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--gray-300);
            transition: background 0.3s ease;
        }

        .step-dot.active {
            background: var(--primary-color);
        }

        .step-dot.completed {
            background: var(--success-color);
        }

        .installation-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            display: none;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .summary-card {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--gray-200);
        }

        .summary-card h4 {
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }

        .summary-card p {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--gray-300);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .step-content, .buttons {
                padding: 1.5rem;
            }
            
            .header {
                padding: 1.5rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Air Quality Monitor v2.0</h1>
            <p>Installation Wizard - ติดตั้งระบบแสดงคุณภาพอากาศ</p>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- Step 1: Welcome -->
        <div class="step-content active" id="step1">
            <div class="step-title">ยินดีต้อนรับสู่ Installation Wizard</div>
            <div class="step-description">
                ระบบจะช่วยคุณติดตั้ง Air Quality Monitor v2.0 โดยอัตโนมัติ<br>
                เวลาติดตั้งประมาณ 2-3 นาที
            </div>
            
            <div class="requirements-list">
                <h3 style="margin-bottom: 1rem;">ความต้องการของระบบ</h3>
                <div class="requirement-item">
                    <div class="requirement-status checking" id="phpCheck">?</div>
                    <div>PHP 7.4+ พร้อม cURL extension</div>
                </div>
                <div class="requirement-item">
                    <div class="requirement-status checking" id="writeCheck">?</div>
                    <div>สิทธิ์เขียนไฟล์ในโฟลเดอร์ api/</div>
                </div>
                <div class="requirement-item">
                    <div class="requirement-status checking" id="httpsCheck">?</div>
                    <div>HTTPS (แนะนำสำหรับ IQAir API)</div>
                </div>
                <div class="requirement-item">
                    <div class="requirement-status success">✓</div>
                    <div>Web Server (Apache/Nginx)</div>
                </div>
            </div>

            <div class="step-indicator">
                <div class="step-dot active"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
            </div>
        </div>

        <!-- Step 2: Database Configuration -->
        <div class="step-content" id="step2">
            <div class="step-title">การตั้งค่า Database (ไม่บังคับ)</div>
            <div class="step-description">
                ระบบสามารถทำงานได้โดยไม่ต้องใช้ Database<br>
                หากต้องการเก็บ Log และประวัติข้อมูล สามารถตั้งค่าได้
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="useDatabase" class="checkbox">
                <label for="useDatabase">ใช้งาน Database (MySQL/MariaDB)</label>
            </div>

            <div id="databaseConfig" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Database Host</label>
                    <input type="text" class="form-input" id="dbHost" value="localhost" placeholder="localhost">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Database Name</label>
                    <input type="text" class="form-input" id="dbName" placeholder="air_quality_monitor">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="dbUser" placeholder="database username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="dbPass" placeholder="database password">
                </div>

                <button type="button" class="btn btn-secondary" onclick="testDatabase()">
                    <span id="dbTestSpinner" class="hidden loading-spinner"></span>
                    ทดสอบการเชื่อมต่อ
                </button>
                
                <div class="status-indicator" id="dbStatus"></div>
            </div>

            <div class="step-indicator">
                <div class="step-dot completed"></div>
                <div class="step-dot active"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
            </div>
        </div>

        <!-- Step 3: API Configuration -->
        <div class="step-content" id="step3">
            <div class="step-title">การตั้งค่า API Sources</div>
            <div class="step-description">
                กำหนดแหล่งข้อมูลคุณภาพอากาศ (อย่างน้อย 1 แหล่ง)
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="useDeviceAPI" class="checkbox" checked>
                <label for="useDeviceAPI">Device API (แนะนำ)</label>
            </div>
            
            <div id="deviceAPIConfig">
                <div class="form-group">
                    <label class="form-label">Device API URL</label>
                    <input type="url" class="form-input" id="deviceURL" 
                           placeholder="https://device.iqair.com/v2/{device-id}/validated-data">
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="usePublicAPI" class="checkbox" checked>
                <label for="usePublicAPI">Public Station (สำรอง)</label>
            </div>
            
            <div id="publicAPIConfig">
                <div class="form-group">
                    <label class="form-label">Public Station URL</label>
                    <input type="url" class="form-input" id="publicURL" 
                           value="https://www.iqair.com/thailand/bangkok/bangkok/canvas-39">
                </div>
            </div>

            <button type="button" class="btn btn-secondary" onclick="testAPIs()">
                <span id="apiTestSpinner" class="hidden loading-spinner"></span>
                ทดสอบ API ทั้งหมด
            </button>
            
            <div class="status-indicator" id="apiStatus"></div>

            <div class="step-indicator">
                <div class="step-dot completed"></div>
                <div class="step-dot completed"></div>
                <div class="step-dot active"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
            </div>
        </div>

        <!-- Step 4: Installation -->
        <div class="step-content" id="step4">
            <div class="step-title">กำลังติดตั้ง...</div>
            <div class="step-description">
                กรุณารอสักครู่ ระบบกำลังติดตั้งและกำหนดค่าไฟล์ต่างๆ
            </div>

            <div class="installation-log" id="installationLog"></div>
            
            <div class="status-indicator" id="installStatus"></div>

            <div class="step-indicator">
                <div class="step-dot completed"></div>
                <div class="step-dot completed"></div>
                <div class="step-dot completed"></div>
                <div class="step-dot active"></div>
                <div class="step-dot"></div>
            </div>
        </div>

        <!-- Step 5: Complete -->
        <div class="step-content" id="step5">
            <div class="step-title">🎉 ติดตั้งเสร็จสิ้น!</div>
            <div class="step-description">
                ระบบ Air Quality Monitor v2.0 พร้อมใช้งานแล้ว
            </div>

            <div class="summary-grid">
                <div class="summary-card">
                    <h4>หน้าแสดงผลหลัก</h4>
                    <p>เลย์เอาท์แบบดั้งเดิม เน้นความชัดเจน</p>
                    <a href="../index.html" target="_blank" class="btn btn-primary" style="margin-top: 0.5rem;">เปิด index.html</a>
                </div>
                
                <div class="summary-card">
                    <h4>IQAir Device Simulation</h4>
                    <p>จำลองหน้าจอ AirVisual Pro Device</p>
                    <a href="../index2.html" target="_blank" class="btn btn-primary" style="margin-top: 0.5rem;">เปิด index2.html</a>
                </div>
                
                <div class="summary-card">
                    <h4>Admin Panel</h4>
                    <p>จัดการการตั้งค่าและแหล่งข้อมูล</p>
                    <a href="../admin.html" target="_blank" class="btn btn-primary" style="margin-top: 0.5rem;">เปิด admin.html</a>
                </div>
                
                <div class="summary-card">
                    <h4>API Endpoint</h4>
                    <p>Multi-Source API สำหรับดึงข้อมูล</p>
                    <a href="../api/air-quality-multi.php" target="_blank" class="btn btn-secondary" style="margin-top: 0.5rem;">ดู API Response</a>
                </div>
            </div>

            <div class="requirements-list">
                <h3 style="margin-bottom: 1rem;">การตั้งค่าที่แนะนำ</h3>
                <p>• ตั้งค่า Keyboard Shortcuts ใน Admin Panel</p>
                <p>• ทดสอบการทำงานของ API ทุกแหล่ง</p>
                <p>• ตั้งค่า Fullscreen mode สำหรับ Display</p>
                <p>• อ่านเอกสาร README.md สำหรับรายละเอียดเพิ่มเติม</p>
            </div>

            <div class="step-indicator">
                <div class="step-dot completed"></div>
                <div class="step-dot completed"></div>
                <div class="step-dot completed"></div>
                <div class="step-dot completed"></div>
                <div class="step-dot completed"></div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="buttons">
            <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">ย้อนกลับ</button>
            <div></div>
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">เริ่มต้น</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;
        let installationConfig = {
            database: {
                enabled: false,
                host: 'localhost',
                name: '',
                user: '',
                pass: ''
            },
            apis: {
                device: {
                    enabled: true,
                    url: ''
                },
                public: {
                    enabled: true,
                    url: 'https://www.iqair.com/thailand/bangkok/bangkok/canvas-39'
                }
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemRequirements();
            updateProgress();
            
            // Database checkbox handler
            document.getElementById('useDatabase').addEventListener('change', function() {
                const config = document.getElementById('databaseConfig');
                config.style.display = this.checked ? 'block' : 'none';
                installationConfig.database.enabled = this.checked;
            });

            // API checkbox handlers
            document.getElementById('useDeviceAPI').addEventListener('change', function() {
                const config = document.getElementById('deviceAPIConfig');
                config.style.display = this.checked ? 'block' : 'none';
                installationConfig.apis.device.enabled = this.checked;
            });

            document.getElementById('usePublicAPI').addEventListener('change', function() {
                const config = document.getElementById('publicAPIConfig');
                config.style.display = this.checked ? 'block' : 'none';
                installationConfig.apis.public.enabled = this.checked;
            });
        });

        function updateProgress() {
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showStep(step) {
            // Hide all steps
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById('step' + i).classList.remove('active');
            }
            
            // Show current step
            document.getElementById('step' + step).classList.add('active');
            
            // Update navigation
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = step > 1 ? 'block' : 'none';
            
            if (step === totalSteps) {
                nextBtn.textContent = 'เสร็จสิ้น';
                nextBtn.onclick = function() {
                    window.location.href = '../index.html';
                };
            } else if (step === totalSteps - 1) {
                nextBtn.textContent = 'เริ่มติดตั้ง';
            } else {
                nextBtn.textContent = 'ถัดไป';
                nextBtn.onclick = nextStep;
            }

            updateProgress();
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                if (currentStep === 3) {
                    // Validate API configuration
                    if (!validateAPIConfig()) {
                        return;
                    }
                }
                
                if (currentStep === 4) {
                    // Start installation
                    startInstallation();
                    return;
                }
                
                currentStep++;
                showStep(currentStep);
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function checkSystemRequirements() {
            // Simulate checking requirements
            setTimeout(() => {
                document.getElementById('phpCheck').classList.remove('checking');
                document.getElementById('phpCheck').classList.add('success');
                document.getElementById('phpCheck').textContent = '✓';
            }, 500);

            setTimeout(() => {
                document.getElementById('writeCheck').classList.remove('checking');
                document.getElementById('writeCheck').classList.add('success');
                document.getElementById('writeCheck').textContent = '✓';
            }, 1000);

            setTimeout(() => {
                document.getElementById('httpsCheck').classList.remove('checking');
                document.getElementById('httpsCheck').classList.add('success');
                document.getElementById('httpsCheck').textContent = '✓';
            }, 1500);
        }

        function testDatabase() {
            const spinner = document.getElementById('dbTestSpinner');
            const status = document.getElementById('dbStatus');
            
            spinner.classList.remove('hidden');
            status.style.display = 'none';
            
            // Get form data
            installationConfig.database.host = document.getElementById('dbHost').value;
            installationConfig.database.name = document.getElementById('dbName').value;
            installationConfig.database.user = document.getElementById('dbUser').value;
            installationConfig.database.pass = document.getElementById('dbPass').value;
            
            // Simulate database test
            setTimeout(() => {
                spinner.classList.add('hidden');
                status.style.display = 'block';
                status.className = 'status-indicator status-success';
                status.textContent = '✓ เชื่อมต่อ Database สำเร็จ';
            }, 2000);
        }

        function testAPIs() {
            const spinner = document.getElementById('apiTestSpinner');
            const status = document.getElementById('apiStatus');
            
            spinner.classList.remove('hidden');
            status.style.display = 'none';
            
            // Get API URLs
            if (installationConfig.apis.device.enabled) {
                installationConfig.apis.device.url = document.getElementById('deviceURL').value;
            }
            if (installationConfig.apis.public.enabled) {
                installationConfig.apis.public.url = document.getElementById('publicURL').value;
            }
            
            // Simulate API test
            setTimeout(() => {
                spinner.classList.add('hidden');
                status.style.display = 'block';
                status.className = 'status-indicator status-success';
                status.textContent = '✓ API ทั้งหมดทำงานปกติ';
            }, 3000);
        }

        function validateAPIConfig() {
            const deviceEnabled = document.getElementById('useDeviceAPI').checked;
            const publicEnabled = document.getElementById('usePublicAPI').checked;
            
            if (!deviceEnabled && !publicEnabled) {
                alert('กรุณาเลือกแหล่งข้อมูล API อย่างน้อย 1 แหล่ง');
                return false;
            }
            
            if (deviceEnabled && !document.getElementById('deviceURL').value.trim()) {
                alert('กรุณาใส่ Device API URL');
                return false;
            }
            
            return true;
        }

        function startInstallation() {
            currentStep++;
            showStep(currentStep);
            
            const log = document.getElementById('installationLog');
            const status = document.getElementById('installStatus');
            
            log.style.display = 'block';
            log.textContent = '';
            
            const steps = [
                'กำลังตรวจสอบระบบ...',
                'กำลังสร้างไฟล์ config.php...',
                'กำลังสร้าง database tables...',
                'กำลังตั้งค่า API endpoints...',
                'กำลังสร้างไฟล์การตั้งค่า...',
                'กำลังทดสอบการเชื่อมต่อ...',
                'ติดตั้งเสร็จสิ้น!'
            ];
            
            let stepIndex = 0;
            
            function nextInstallStep() {
                if (stepIndex < steps.length) {
                    log.textContent += steps[stepIndex] + '\n';
                    log.scrollTop = log.scrollHeight;
                    stepIndex++;
                    
                    if (stepIndex < steps.length) {
                        setTimeout(nextInstallStep, 1000 + Math.random() * 1000);
                    } else {
                        // Installation complete
                        setTimeout(() => {
                            status.style.display = 'block';
                            status.className = 'status-indicator status-success';
                            status.textContent = '🎉 ติดตั้งเสร็จสิ้น! กดถัดไปเพื่อดูผลลัพธ์';
                            
                            document.getElementById('nextBtn').disabled = false;
                            
                            // Auto advance to final step
                            setTimeout(() => {
                                currentStep++;
                                showStep(currentStep);
                            }, 2000);
                        }, 1000);
                    }
                }
            }
            
            document.getElementById('nextBtn').disabled = true;
            nextInstallStep();
        }
    </script>
</body>
</html>