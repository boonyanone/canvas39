<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas 39 - Elevator Display</title>
    
    <!-- Tailwind CSS -->
    <script>
        // ‡∏õ‡∏¥‡∏î warning console - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
        (function() {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                const message = args.join(' ');
                if (message.includes('tailwindcss.com should not be used in production') || 
                    message.includes('cdn.tailwindcss.com should not be used in production')) {
                    return; // ‡∏ã‡πà‡∏≠‡∏ô warning ‡∏ô‡∏µ‡πâ
                }
                originalWarn.apply(console, args);
            };
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        if (window.tailwind) {
            window.tailwind.config = { 
                corePlugins: { preflight: false }
            };
        }
    </script>
    
    <style>
        /* Fix any styling issues */
        body {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Slideshow optimization for tablet */
        #slide1, #slide2 {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            will-change: transform;
        }
        
        /* Hardware acceleration for smooth transitions */
        .transition-transform {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        
        /* Slide positioning classes */
        .slide-active {
            -webkit-transform: translateX(0) translateZ(0) !important;
            transform: translateX(0) translateZ(0) !important;
        }
        
        .slide-next {
            -webkit-transform: translateX(100%) translateZ(0) !important;
            transform: translateX(100%) translateZ(0) !important;
        }
        
        .slide-prev {
            -webkit-transform: translateX(-100%) translateZ(0) !important;
            transform: translateX(-100%) translateZ(0) !important;
        }
        
        /* Ensure borders and layout stay intact */
        .border-t-2 {
            border-top-width: 2px !important;
            border-top-style: solid !important;
        }
        
        .border-gray-300 {
            border-color: #d1d5db !important;
        }
        
        /* Force display of weather section border */
        .weather-section-border {
            border-top: 2px solid #d1d5db !important;
        }
        
        /* HR line styles for AQI sections */
        hr {
            border: none !important;
            border-top: 1px solid !important;
            margin: 8px 0 !important;
        }
    </style>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <!-- JSONBin.io + Firebase Configuration -->
    <script>
        // JSONBin.io Configuration (Primary)
        const JSONBIN_CONFIG = {
            binId: '68d0fd7643b1c97be94b2806',
            accessKey: '$2a$10$9izErv0jJeqLJODXAxr15ugm42tS.ibw1QqZdOLFV.3XNeBNVsCda'
        };
        
        console.log('üì¶ JSONBin.io configured for display (Primary)');
        
        // Debug function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logo
        window.debugLogo = function() {
            const logoImg = document.querySelector('img[alt="Canvas 39 Logo"]');
            if (logoImg) {
                console.log('üñºÔ∏è Logo element:', logoImg);
                console.log('üñºÔ∏è Logo src:', logoImg.src);
                console.log('üñºÔ∏è Logo filter:', logoImg.style.filter);
                console.log('üñºÔ∏è Logo computed style:', getComputedStyle(logoImg).filter);
                
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö filter
                logoImg.style.filter = 'brightness(0) invert(1)';
                console.log('üß™ Applied white filter to logo');
            } else {
                console.log('‚ùå Logo element not found');
                // ‡∏´‡∏≤ logo elements ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                console.log('üîç All img elements:', document.querySelectorAll('img'));
            }
        };
        
        // Debug function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin
        window.debugAdminLogo = function() {
            const logoPreview = document.getElementById('logoPreview');
            if (logoPreview) {
                console.log('üñºÔ∏è Admin logo preview:', logoPreview);
                console.log('üñºÔ∏è Admin logo src:', logoPreview.src);
            } else {
                console.log('‚ùå Admin logo preview not found');
            }
        };
    </script>
    
    <!-- Firebase SDK (Backup) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDJ2iqJUyjd5m0xe0rz-IyRiNyCD3Ga8XM",
            authDomain: "canvas39-display.firebaseapp.com",
            databaseURL: "https://canvas39-display-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "canvas39-display",
            storageBucket: "canvas39-display.firebasestorage.app",
            messagingSenderId: "126886607717",
            appId: "1:126886607717:web:01029a9d874d87dfc5bf8c"
        };
        
        try {
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            
            // Make Firebase functions globally available
            window.firebaseDB = database;
            window.firebaseRef = ref;
            window.firebaseGet = get;
            
            console.log('üî• Firebase initialized for display (Backup)');
        } catch (error) {
            console.warn('‚ö†Ô∏è Firebase backup not available for display:', error);
        }
    </script>
    
    <style>
        /* Weather Icon Animations */
        .weather-icon-sun {
            animation: rotate 8s linear infinite;
        }
        
        .weather-icon-rain {
            animation: rain-drop 2s ease-in-out infinite;
        }
        
        .weather-icon-cloud {
            animation: float 4s ease-in-out infinite;
        }
        
        .weather-icon-thunder {
            animation: thunder-flash 3s ease-in-out infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes rain-drop {
            0%, 100% { transform: translateY(0px); opacity: 1; }
            50% { transform: translateY(2px); opacity: 0.8; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-2px); }
        }
        
        @keyframes thunder-flash {
            0%, 90%, 100% { opacity: 1; }
            5%, 15% { opacity: 0.8; }
            10% { opacity: 1.2; filter: brightness(1.2); }
        }
    </style>
</head>
<body>
    <div class="w-full h-screen bg-stone-400 flex flex-col">
        <!-- Header -->
        <div class="bg-amber-900 flex items-center justify-between px-8 py-4 flex-shrink-0 h-[10.53vh]" style="background-color: #3f2f15;">
            <div class="w-16 h-16 flex items-center justify-center">
                <img src="img/logo.png" alt="Canvas 39 Logo" class="w-full h-full object-contain" style="filter: brightness(0) invert(1);">
            </div>
            <div class="text-center text-white">
                <div class="text-2xl mb-2" id="currentDate">Wednesday, 27 November</div>
                <div class="text-4xl font-light" id="currentTime">16:41</div>
            </div>
            <button id="fullscreenBtn" class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center text-white hover:bg-opacity-30 transition-all duration-300">
                <i data-lucide="maximize" class="w-4 h-4" id="fullscreenIcon"></i>
            </button>
        </div>

        <!-- Building Image Section -->
        <div class="flex items-center justify-center text-white text-lg h-[31.58vh] flex-shrink-0 relative" style="background-color: #87ceeb; background-image: url('img/FRONT FULL.jpg'); background-size: cover; background-repeat: no-repeat; background-position: center;">
            <!-- Notification Overlay -->
            <div id="notificationOverlay" class="absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center z-10 hidden">
                <div class="bg-white rounded-lg p-6 max-w-md mx-4 text-center shadow-2xl">
                    <div id="notificationContent" class="text-gray-700"></div>
                </div>
            </div>
        </div>

        <!-- Weather Section -->
        <div class="border-t-2 border-gray-300 weather-section-border flex flex-shrink-0 h-[15.79vh]" style="background-color: #e8ddd4;">
            <!-- Today -->
            <div class="w-2/5 p-4 flex flex-col justify-start" style="background-color: #f3efe6;">
                <div class="text-lg font-medium mb-3" style="color: #3f2f15;">TODAY</div>
                <div class="flex flex-col items-center justify-center flex-1">
                    <div class="w-8 h-8 sm:w-12 sm:h-12 mb-1" id="todayIcon">
                        <svg viewBox="0 0 48 48" class="w-full h-full">
                            <!-- Rain Cloud -->
                            <path d="M36 20c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 .685.057 1.354.166 2.001C9.97 22.46 8 24.81 8 27.5 8 30.537 10.463 33 13.5 33h21c3.037 0 5.5-2.463 5.5-5.5 0-2.69-1.97-5.04-4.166-5.499.109-.647.166-1.316.166-2.001z" fill="none" stroke="#3f2f15" stroke-width="2"/>
                            <!-- Rain Drops -->
                            <line x1="16" y1="36" x2="16" y2="42" stroke="#3f2f15" stroke-width="2" stroke-linecap="round"/>
                            <line x1="20" y1="38" x2="20" y2="44" stroke="#3f2f15" stroke-width="2" stroke-linecap="round"/>
                            <line x1="24" y1="36" x2="24" y2="42" stroke="#3f2f15" stroke-width="2" stroke-linecap="round"/>
                            <line x1="28" y1="38" x2="28" y2="44" stroke="#3f2f15" stroke-width="2" stroke-linecap="round"/>
                            <line x1="32" y1="36" x2="32" y2="42" stroke="#3f2f15" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="text-lg flex items-center gap-1 font-medium" style="color: #3f2f15;">
                        <span id="lowTemp">26¬∞C</span>
                        <span>/</span>
                        <span id="highTemp">34¬∞C</span>
                    </div>
                </div>
            </div>
            <!-- Outlook -->
            <div class="w-3/5 p-4 flex flex-col justify-start" style="background-color: #ddd6cc;">
                <div class="text-lg font-medium mb-3" style="color: #3f2f15;">OUTLOOK</div>
                <div class="grid grid-cols-4 gap-3 flex-1 items-center" id="forecastGrid">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Quality Information Slideshow -->
        <div class="relative flex-shrink-0 h-[42.1vh] overflow-hidden" style="background-color: #929079;">
            <!-- Slide Navigation Dots - Bottom Center -->
            <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 z-10 flex gap-3">
                <div class="w-4 h-4 rounded-full bg-white bg-opacity-60 hover:bg-opacity-80 transition-all duration-300 cursor-pointer shadow-lg" id="slideDot1"></div>
                <div class="w-4 h-4 rounded-full bg-white bg-opacity-30 hover:bg-opacity-50 transition-all duration-300 cursor-pointer shadow-lg" id="slideDot2"></div>
            </div>
            
            <!-- Slide 1: Air Quality -->
            <div class="absolute inset-0 transition-transform duration-1000 ease-in-out slide-active" id="slide1">
                <div class="p-8 h-full flex flex-col">
                    <!-- Header Title -->
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-medium tracking-wide" style="color: #3f2f15;">AIR QUALITY</h2>
                    </div>
                    
                    <!-- Content Grid -->
                    <div class="flex gap-8 mb-8">
                        <!-- Indoor Section -->
                        <div class="flex-1">
                            <div class="text-lg mb-3 font-medium" style="color: #3f2f15;">
                                <span class="inline-block px-3 py-1 bg-white bg-opacity-20 rounded-full">INDOOR</span>
                            </div>
                            <div class="bg-green-500 rounded-xl shadow-lg overflow-hidden">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="flex flex-col">
                                            <div class="flex items-end gap-3 mb-2">
                                                <div class="text-5xl font-light leading-none" style="color: #3f2f15;" id="indoorAQI">40</div>
                                                <div class="text-lg font-semibold pb-1" style="color: #3f2f15;" id="indoorLevel">Good</div>
                                            </div>
                                            <div class="text-sm opacity-80" style="color: #3f2f15;">US AQI Index</div>
                                        </div>
                                        <div class="w-12 h-12 flex-shrink-0" id="indoorFace">
                                            <img src="https://www.iqair.com/dl/assets/aqi/ic-face-green.svg" alt="AQI Face" class="w-full h-full object-contain filter brightness-0">
                                        </div>
                                    </div>
                                    <div class="border-t border-white border-opacity-30 pt-3">
                                        <div class="flex justify-between items-center text-sm" style="color: #3f2f15;">
                                            <span class="opacity-80">Main pollutant:</span>
                                            <span class="font-semibold" id="indoorPollutant">PM10</span>
                                        </div>
                                        <div class="flex justify-between items-center text-sm mt-1" style="color: #3f2f15;">
                                            <span class="opacity-80">Concentration:</span>
                                            <span class="font-semibold"><span id="indoorConcentration">43.5</span> Œºg/m¬≥</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Outdoor Section -->
                        <div class="flex-1">
                            <div class="text-lg mb-3 font-medium" style="color: #3f2f15;">
                                <span class="inline-block px-3 py-1 bg-white bg-opacity-20 rounded-full">OUTDOOR</span>
                            </div>
                            <div class="bg-yellow-500 rounded-xl shadow-lg overflow-hidden">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="flex flex-col">
                                            <div class="flex items-end gap-3 mb-2">
                                                <div class="text-5xl font-light leading-none" style="color: #3f2f15;" id="outdoorAQI">84</div>
                                                <div class="text-lg font-semibold pb-1" style="color: #3f2f15;" id="outdoorLevel">Moderate</div>
                                            </div>
                                            <div class="text-sm opacity-80" style="color: #3f2f15;">US AQI Index</div>
                                        </div>
                                        <div class="w-12 h-12 flex-shrink-0" id="outdoorFace">
                                            <img src="https://www.iqair.com/dl/assets/aqi/ic-face-yellow.svg" alt="AQI Face" class="w-full h-full object-contain filter brightness-0">
                                        </div>
                                    </div>
                                    <div class="border-t border-white border-opacity-30 pt-3">
                                        <div class="flex justify-between items-center text-sm" style="color: #3f2f15;">
                                            <span class="opacity-80">Main pollutant:</span>
                                            <span class="font-semibold" id="outdoorPollutant">PM2.5</span>
                                        </div>
                                        <div class="flex justify-between items-center text-sm mt-1" style="color: #3f2f15;">
                                            <span class="opacity-80">Concentration:</span>
                                            <span class="font-semibold"><span id="outdoorConcentration">27</span> Œºg/m¬≥</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Spacer -->
                    <div class="flex-1"></div>
                </div>
            </div>

            <!-- Slide 2: Pool Water Quality -->
            <div class="absolute inset-0 transition-transform duration-1000 ease-in-out slide-next" id="slide2">
                <div class="p-8 h-full flex flex-col" style="background-color: #b7a591;">
                    <!-- Header Title -->
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-medium tracking-wide" style="color: #3f2f15;">POOL WATER QUALITY</h2>
                    </div>
                    
                    <!-- Content Grid -->
                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <!-- Temperature -->
                        <div class="flex flex-col">
                            <div class="text-lg mb-3 font-medium" style="color: #3f2f15;">
                                <span class="inline-block px-3 py-1 bg-white bg-opacity-20 rounded-full">TEMPERATURE</span>
                            </div>
                            <div class="bg-blue-500 rounded-xl shadow-lg overflow-hidden">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="flex flex-col">
                                            <div class="flex items-end gap-3 mb-2">
                                                <div class="text-4xl font-light leading-none" style="color: #3f2f15;" id="poolTemperature">27.5</div>
                                                <div class="text-lg font-semibold pb-1" style="color: #3f2f15;">¬∞C</div>
                                            </div>
                                            <div class="text-sm opacity-80" style="color: #3f2f15;">Water Temperature</div>
                                        </div>
                                        <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center bg-white bg-opacity-20 rounded-full">
                                            <svg class="w-6 h-6" style="color: #3f2f15;" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2c1.1 0 2 .9 2 2v8.5c1.2.7 2 2 2 3.5 0 2.2-1.8 4-4 4s-4-1.8-4-4c0-1.5.8-2.8 2-3.5V4c0-1.1.9-2 2-2zm0 2c-.6 0-1 .4-1 1v8c0 .4-.2.7-.5.9-.8.5-1.5 1.3-1.5 2.1 0 1.1.9 2 2 2s2-.9 2-2c0-.8-.7-1.6-1.5-2.1-.3-.2-.5-.5-.5-.9V5c0-.6-.4-1-1-1z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="border-t border-white border-opacity-30 pt-3">
                                        <div class="text-sm font-semibold" style="color: #3f2f15;">OPTIMAL</div>
                                        <div class="text-xs opacity-80" style="color: #3f2f15;">Ideal for swimming</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- pH Level -->
                        <div class="flex flex-col">
                            <div class="text-lg mb-3 font-medium" style="color: #3f2f15;">
                                <span class="inline-block px-3 py-1 bg-white bg-opacity-20 rounded-full">pH LEVEL</span>
                            </div>
                            <div class="bg-green-500 rounded-xl shadow-lg overflow-hidden">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="flex flex-col">
                                            <div class="flex items-end gap-3 mb-2">
                                                <div class="text-4xl font-light leading-none" style="color: #3f2f15;" id="poolPH">7.4</div>
                                                <div class="text-lg font-semibold pb-1" style="color: #3f2f15;">pH</div>
                                            </div>
                                            <div class="text-sm opacity-80" style="color: #3f2f15;">Acid-Base Balance</div>
                                        </div>
                                        <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center bg-white bg-opacity-20 rounded-full">
                                            <svg class="w-6 h-6" style="color: #3f2f15;" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M9.5 2c-.8 0-1.5.7-1.5 1.5v1c-1.5.3-3 1.3-3.8 2.8-.5.9-.2 2 .7 2.5s2 .2 2.5-.7c.4-.7 1.2-1.1 2.1-1.1s1.7.4 2.1 1.1c.5.9 1.6 1.2 2.5.7s1.2-1.6.7-2.5C14.5 5.8 13 4.8 11.5 4.5v-1C11.5 2.7 10.8 2 10 2h-.5zm-6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm17 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM12 14c-3.3 0-6 2.7-6 6 0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2 0-3.3-2.7-6-6-6z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="border-t border-white border-opacity-30 pt-3">
                                        <div class="text-sm font-semibold" style="color: #3f2f15;">OPTIMAL</div>
                                        <div class="text-xs opacity-80" style="color: #3f2f15;">Perfect balance</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ORP -->
                        <div class="flex flex-col">
                            <div class="text-lg mb-3 font-medium" style="color: #3f2f15;">
                                <span class="inline-block px-3 py-1 bg-white bg-opacity-20 rounded-full">ORP</span>
                            </div>
                            <div class="bg-green-500 rounded-xl shadow-lg overflow-hidden">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="flex flex-col">
                                            <div class="flex items-end gap-3 mb-2">
                                                <div class="text-4xl font-light leading-none" style="color: #3f2f15;" id="poolORP">720</div>
                                                <div class="text-lg font-semibold pb-1" style="color: #3f2f15;">mV</div>
                                            </div>
                                            <div class="text-sm opacity-80" style="color: #3f2f15;">Disinfection Power</div>
                                        </div>
                                        <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center bg-white bg-opacity-20 rounded-full">
                                            <svg class="w-6 h-6" style="color: #3f2f15;" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M7 2v11h3v9l7-12h-4l3-8z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="border-t border-white border-opacity-30 pt-3">
                                        <div class="text-sm font-semibold" style="color: #3f2f15;">GOOD</div>
                                        <div class="text-xs opacity-80" style="color: #3f2f15;">Effective sanitization</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- TDS -->
                        <div class="flex flex-col">
                            <div class="text-lg mb-3 font-medium" style="color: #3f2f15;">
                                <span class="inline-block px-3 py-1 bg-white bg-opacity-20 rounded-full">TDS</span>
                            </div>
                            <div class="bg-yellow-500 rounded-xl shadow-lg overflow-hidden">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="flex flex-col">
                                            <div class="flex items-end gap-3 mb-2">
                                                <div class="text-4xl font-light leading-none" style="color: #3f2f15;" id="poolTDS">450</div>
                                                <div class="text-lg font-semibold pb-1" style="color: #3f2f15;">ppm</div>
                                            </div>
                                            <div class="text-sm opacity-80" style="color: #3f2f15;">Total Dissolved Solids</div>
                                        </div>
                                        <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center bg-white bg-opacity-20 rounded-full">
                                            <svg class="w-6 h-6" style="color: #3f2f15;" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="border-t border-white border-opacity-30 pt-3">
                                        <div class="text-sm font-semibold" style="color: #3f2f15;">GOOD</div>
                                        <div class="text-xs opacity-80" style="color: #3f2f15;">Within normal range</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Water Index Status -->
                    <div class="mb-6">
                        <div class="bg-white bg-opacity-20 rounded-xl p-4 text-center">
                            <div class="text-lg font-medium mb-1" style="color: #3f2f15;">Water Index</div>
                            <div class="text-2xl font-bold text-green-600">OPTIMAL</div>
                            <div class="text-sm opacity-80" style="color: #3f2f15;">Safe for swimming</div>
                        </div>
                    </div>
                    
                    <!-- Bottom Spacer -->
                    <div class="flex-1"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse configuration from Firebase, JSONBin.io, or localStorage
        async function parseConfig() {
            
            
            // Try to load from JSONBin.io (Primary)
            try {
                console.log('üì¶ Loading config from JSONBin.io (Primary)...');
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Access-Key': JSONBIN_CONFIG.accessKey
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const configData = result.record;
                    
                    console.log('‚úÖ Configuration loaded from JSONBin.io:', configData);
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö cache
                    try {
                        localStorage.setItem('canvas39_admin_config', JSON.stringify(configData));
                        console.log('üíæ Config cached to localStorage');
                    } catch (error) {
                        console.warn('‚ùå Failed to cache config:', error);
                    }
                    
                    return configData;
                } else {
                    console.log('‚ö†Ô∏è JSONBin.io response not ok, trying Firebase backup...');
                }
            } catch (error) {
                console.error('‚ùå Failed to load from JSONBin.io:', error);
            }
            
            // Try Firebase backup
            if (window.firebaseDB && window.firebaseGet && window.firebaseRef) {
                try {
                    console.log('üî• Loading config from Firebase (Backup)...');
                    const snapshot = await window.firebaseGet(window.firebaseRef(window.firebaseDB, 'canvas39-config'));
                    
                    if (snapshot.exists()) {
                        const configData = snapshot.val();
                        console.log('‚úÖ Configuration loaded from Firebase backup:', configData);
                        
                        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö cache
                        try {
                            localStorage.setItem('canvas39_admin_config', JSON.stringify(configData));
                            console.log('üíæ Config cached to localStorage from Firebase');
                        } catch (error) {
                            console.warn('‚ùå Failed to cache config:', error);
                        }
                        
                        return configData;
                    } else {
                        console.log('‚ö†Ô∏è No config found in Firebase backup either...');
                    }
                } catch (error) {
                    console.error('‚ùå Failed to load from Firebase backup:', error);
                }
            }
            
            // Fallback to localStorage (for cache/offline usage)
            try {
                const savedConfig = localStorage.getItem('canvas39_admin_config');
                console.log('üîç Checking localStorage cache:', savedConfig ? 'Found' : 'Empty');
                if (savedConfig) {
                    console.log('üìÑ Loading config from localStorage cache');
                    const parsed = JSON.parse(savedConfig);
                    console.log('üìä Config data:', parsed);
                    return parsed;
                }
            } catch (error) {
                console.error('‚ùå Error parsing config from localStorage:', error);
            }
            
            console.log('‚ö†Ô∏è No configuration found - creating default config');
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á default config ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
            const defaultConfig = {
                font: 'default',
                weatherApi: 'openmeteo',
                updateInterval: 10,
                notices: [],
                images: {
                    logo: 'img/logo.png',
                    building: 'img/FRONT FULL.jpg'
                }
            };
            
            try {
                localStorage.setItem('canvas39_admin_config', JSON.stringify(defaultConfig));
                console.log('‚úÖ Default config created and saved');
            } catch (error) {
                console.error('‚ùå Failed to save default config:', error);
            }
            
            return defaultConfig;
        }

        // Listen for config updates from other windows (BroadcastChannel)
        function listenForConfigUpdates() {
            try {
                const channel = new BroadcastChannel('canvas39-config');
                console.log('üìª BroadcastChannel listener started');
                
                channel.addEventListener('message', async (event) => {
                    console.log('üì° Received broadcast message:', event.data);
                    if (event.data.type === 'config-update') {
                        console.log('üîÑ Processing config update from admin panel');
                        
                        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï localStorage cache
                        try {
                            localStorage.setItem('canvas39_admin_config', JSON.stringify(event.data.config));
                            console.log('üíæ Config cached to localStorage');
                        } catch (error) {
                            console.error('‚ùå Failed to save config to localStorage:', error);
                        }
                        
                        // Apply config to display immediately
                        applyConfig(event.data.config);
                    }
                });
                
                channel.addEventListener('error', (error) => {
                    console.error('‚ùå BroadcastChannel error:', error);
                });
                
            } catch (error) {
                console.warn('‚ùå BroadcastChannel not supported:', error);
            }
        }

        // Apply configuration to display
        function applyConfig(config) {
            if (!config) {
                console.log('‚ö†Ô∏è No config found, using default');
                return;
            }

            console.log('üîß Applying configuration:', config);

            // Apply font
            if (config.font && config.font !== 'default') {
                const fontMap = {
                    'roman': { family: 'Roman', source: 'local' },
                    'kanit': { family: 'Kanit', source: 'google' },
                    'sarabun': { family: 'Sarabun', source: 'google' },
                    'inter': { family: 'Inter', source: 'google' }
                };

                const selectedFont = fontMap[config.font];
                if (selectedFont) {
                    if (selectedFont.source === 'google') {
                        // Load Google Font
                        const link = document.createElement('link');
                        link.rel = 'stylesheet';
                        link.href = `https://fonts.googleapis.com/css2?family=${selectedFont.family}:wght@300;400;500;600;700&display=swap`;
                        document.head.appendChild(link);
                    }
                    
                    // Apply font to body
                    document.body.style.fontFamily = `'${selectedFont.family}', sans-serif`;
                }
            }

            // Apply images
            if (config.images) {
                if (config.images.logo) {
                    const logoImg = document.querySelector('img[alt="Canvas 39 Logo"]');
                    if (logoImg) {
                        logoImg.src = config.images.logo;
                        // ‡πÄ‡∏Å‡πá‡∏ö filter ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÑ‡∏ß‡πâ
                        logoImg.style.filter = 'brightness(0) invert(1)';
                        console.log('üñºÔ∏è Logo updated with white filter:', config.images.logo.substring(0, 50) + '...');
                    }
                }
                
                if (config.images.building) {
                    const buildingSection = document.querySelector('[style*="background-image"]');
                    if (buildingSection) {
                        buildingSection.style.backgroundImage = `url('${config.images.building}')`;
                    }
                }
            }

            // Update API configuration
            if (config.weatherApi) {
                WEATHER_API_PROVIDER = config.weatherApi;
            }
            
            if (config.openweatherKey) {
                WEATHER_API_KEY = config.openweatherKey;
            }

            // Update intervals
            if (config.updateInterval) {
                UPDATE_INTERVAL = config.updateInterval * 60 * 1000; // Convert to milliseconds
            }

            // Show notices if any are active
            if (config.notices && config.notices.length > 0) {
                console.log('üì¢ Found notices in config:', config.notices);
                showNotice(config.notices);
            } else {
                console.log('‚ö†Ô∏è No notices found in config');
            }

            console.log('‚úÖ Configuration applied successfully');
        }

        // Show notice in building section (permanent display)
        function showNotice(notices) {
            console.log('üì¢ showNotice called with:', notices);
            const overlay = document.getElementById('notificationOverlay');
            const content = document.getElementById('notificationContent');
            
            if (!overlay || !content) {
                console.log('‚ùå Overlay or content element not found');
                return;
            }
            
            // Find active notices
            const activeNotices = notices.filter(notice => notice.active);
            console.log('‚úÖ Active notices found:', activeNotices.length);
            
            if (activeNotices.length > 0) {
                // Show the first active notice
                console.log('üì∫ Showing notice:', activeNotices[0].title);
                content.innerHTML = activeNotices[0].content;
                overlay.classList.remove('hidden');
            } else {
                console.log('‚ö†Ô∏è No active notices, hiding overlay');
                // Hide overlay if no active notices
                overlay.classList.add('hidden');
            }
        }

        // Initialize Lucide icons
        lucide.createIcons();
        
        // Configuration defaults
        let WEATHER_API_KEY = 'db61b712294c46506059042663feeac6'; // OpenWeatherMap API Key
        let WEATHER_API_PROVIDER = 'openmeteo'; // Default provider
        let UPDATE_INTERVAL = 10 * 60 * 1000; // 10 minutes
        const CITY = 'Bangkok,TH';
        
        // WeatherAPI.com (Free alternative - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á API key)
        const WEATHER_API_URL = 'https://api.weatherapi.com/v1/current.json?key=demo&q=Bangkok&aqi=no';
        
        // Mock data (fallback)
        const mockData = {
            weather: {
                current: {
                    condition: "Partly Cloudy",
                    high: 34,
                    low: 26
                },
                forecast: [
                    { time: "11:00", condition: "Sunny", icon: "sun", temperature: 32 },
                    { time: "12:00", condition: "Partly Cloudy", icon: "cloud", temperature: 33 },
                    { time: "13:00", condition: "Rainy", icon: "cloud-rain", temperature: 31 },
                    { time: "14:00", condition: "Thunderstorm", icon: "zap", temperature: 29 }
                ]
            },
            airQuality: {
                indoor: { aqi: 40, level: "Good", pollutant: "PM10", concentration: 43.5 },
                outdoor: { aqi: 84, level: "Moderate", pollutant: "PM2.5", concentration: 27 }
            },
            waterQuality: {
                water: { ph: 7.2, chlorine: 1.8 },
                pool: { 
                    ph: 7.4, 
                    chlorine: 2.1, 
                    temperature: 27.5,
                    orp: 720,
                    tds: 450
                }
            }
        };

        function updateFaceIcon(elementId, aqi) {
            const element = document.getElementById(elementId);
            let iconUrl = '';
            
            if (aqi <= 50) {
                iconUrl = 'https://www.iqair.com/dl/assets/aqi/ic-face-green.svg';
            } else if (aqi <= 100) {
                iconUrl = 'https://www.iqair.com/dl/assets/aqi/ic-face-yellow.svg';
            } else if (aqi <= 150) {
                iconUrl = 'https://www.iqair.com/dl/assets/aqi/ic-face-orange.svg';
            } else if (aqi <= 200) {
                iconUrl = 'https://www.iqair.com/dl/assets/aqi/ic-face-red.svg';
            } else {
                iconUrl = 'https://www.iqair.com/dl/assets/aqi/ic-face-purple.svg';
            }
            
            // ‡πÉ‡∏ä‡πâ filter brightness-0 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥
            element.innerHTML = `<img src="${iconUrl}" alt="AQI Face" class="w-full h-full object-contain filter brightness-0">`;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI ‡∏à‡∏≤‡∏Å IQAir Canvas 39 (‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ)
        async function fetchCanvas39AQI() {
            // ‡∏•‡∏¥‡∏™‡∏ï‡πå proxy servers ‡∏ó‡∏µ‡πà‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
            const proxies = [
                'https://cors-anywhere.herokuapp.com/',
                'https://corsproxy.io/?',
                'https://api.codetabs.com/v1/proxy?quest='
            ];
            
            const targetUrl = 'https://www.iqair.com/thailand/bangkok/bangkok/canvas-39';
            
            for (const proxy of proxies) {
                try {
                    console.log(`üîÑ ‡∏•‡∏≠‡∏á proxy: ${proxy}`);
                    
                    const response = await fetch(proxy + encodeURIComponent(targetUrl), {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    if (!response.ok) continue;
                    
                    const htmlContent = await response.text();
                    
                    // Extract AQI data ‡∏à‡∏≤‡∏Å HTML (regex pattern)
                    const aqiMatch = htmlContent.match(/aqi[":]*\s*(\d+)/i);
                    const levelMatch = htmlContent.match(/status[":]*\s*["']([^"']+)["']/i);
                    const pollutantMatch = htmlContent.match(/pollutant[":]*\s*["']([^"']+)["']/i);
                    const concentrationMatch = htmlContent.match(/concentration[":]*\s*(\d+\.?\d*)/i);
                    
                    if (aqiMatch) {
                        const aqiData = {
                            aqi: parseInt(aqiMatch[1]),
                            level: levelMatch ? levelMatch[1] : 'Unknown',
                            pollutant: pollutantMatch ? pollutantMatch[1] : 'PM2.5',
                            concentration: concentrationMatch ? parseFloat(concentrationMatch[1]) : 0
                        };
                        
                        console.log('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI Canvas 39 ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', aqiData);
                        return aqiData;
                    }
                    
                } catch (error) {
                    console.log(`‚ùå Proxy ${proxy} ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:`, error.message);
                    continue;
                }
            }
            
            // ‡∏ñ‡πâ‡∏≤ scraping ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ IQAir API ‡∏™‡∏≥‡∏£‡∏≠‡∏á
            try {
                console.log('üîÑ ‡∏•‡∏≠‡∏á IQAir API ‡∏™‡∏≥‡∏£‡∏≠‡∏á...');
                const response = await fetch(
                    'https://api.airvisual.com/v2/city?city=Bangkok&state=Bangkok&country=Thailand&key=demo'
                );
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'success') {
                        const aqiData = {
                            aqi: data.data.current.pollution.aqius,
                            level: getAQILevel(data.data.current.pollution.aqius),
                            pollutant: 'PM2.5',
                            concentration: data.data.current.pollution.aqius
                        };
                        
                        console.log('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI ‡∏à‡∏≤‡∏Å IQAir API ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', aqiData);
                        return aqiData;
                    }
                }
            } catch (error) {
                console.log('‚ùå IQAir API ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error.message);
            }
            
            console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ mock data');
            return null;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á AQI ‡πÄ‡∏õ‡πá‡∏ô level
        function getAQILevel(aqi) {
            if (aqi <= 50) return 'Good';
            else if (aqi <= 100) return 'Moderate';
            else if (aqi <= 150) return 'Unhealthy for Sensitive Groups';
            else if (aqi <= 200) return 'Unhealthy';
            else if (aqi <= 300) return 'Very Unhealthy';
            else return 'Hazardous';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å OpenMeteo (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
        async function fetchOpenMeteoWeather() {
            // Allow execution even if not the primary provider (for fallback)
            if (WEATHER_API_PROVIDER !== 'openmeteo' && arguments[0] !== 'fallback') return null;
            
            try {
                // Bangkok coordinates
                const lat = 13.7563;
                const lng = 100.5018;
                
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=temperature_2m,weather_code,relative_humidity_2m,wind_speed_10m&hourly=temperature_2m,weather_code&timezone=Asia%2FBangkok&forecast_days=1`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üå°Ô∏è OpenMeteo Raw Data:', data);
                
                const current = data.current;
                const hourly = data.hourly;
                
                const processedData = {
                    weather: {
                        current: {
                            condition: mapOpenMeteoWeatherCode(current.weather_code),
                            high: Math.round(current.temperature_2m + 3),
                            low: Math.round(current.temperature_2m - 3)
                        },
                        forecast: hourly.time.slice(1, 5).map((time, index) => {
                            const hour = new Date(time).toLocaleTimeString('th-TH', {
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: false
                            });
                            return {
                                time: hour,
                                condition: mapOpenMeteoWeatherCode(hourly.weather_code[index + 1]),
                                temperature: Math.round(hourly.temperature_2m[index + 1])
                            };
                        })
                    }
                };
                
                console.log('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OpenMeteo ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', processedData);
                console.log('üìä ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:', current.temperature_2m, '¬∞C');
                console.log('üí® ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô:', current.relative_humidity_2m, '%');
                console.log('üå¨Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏•‡∏°:', current.wind_speed_10m, 'km/h');
                console.log('‚è∞ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠:', new Date().toLocaleTimeString('th-TH'));
                
                return processedData;
                
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î OpenMeteo API:', error);
                return null;
            }
        }
        
        // ‡πÅ‡∏õ‡∏•‡∏á weather code ‡∏Ç‡∏≠‡∏á OpenMeteo
        function mapOpenMeteoWeatherCode(code) {
            const codeMap = {
                0: 'Sunny',           // Clear sky
                1: 'Sunny',           // Mainly clear
                2: 'Partly Cloudy',   // Partly cloudy
                3: 'Partly Cloudy',   // Overcast
                45: 'Partly Cloudy',  // Fog
                48: 'Partly Cloudy',  // Depositing rime fog
                51: 'Rainy',          // Drizzle: Light
                53: 'Rainy',          // Drizzle: Moderate
                55: 'Rainy',          // Drizzle: Dense
                61: 'Rainy',          // Rain: Slight
                63: 'Rainy',          // Rain: Moderate
                65: 'Rainy',          // Rain: Heavy
                80: 'Rainy',          // Rain showers: Slight
                81: 'Rainy',          // Rain showers: Moderate
                82: 'Rainy',          // Rain showers: Violent
                95: 'Thunderstorm',   // Thunderstorm: Slight
                96: 'Thunderstorm',   // Thunderstorm with hail
                99: 'Thunderstorm'    // Thunderstorm with heavy hail
            };
            return codeMap[code] || 'Partly Cloudy';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á API Key (wttr.in backup)
        async function fetchFreeWeatherData() {
            // Allow execution even if not the primary provider (for fallback)
            if (WEATHER_API_PROVIDER !== 'wttr' && arguments[0] !== 'fallback') return null;
            
            try {
                // ‡πÉ‡∏ä‡πâ wttr.in - free weather API ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á key
                const response = await fetch('https://wttr.in/Bangkok?format=j1');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üå°Ô∏è Free Weather Raw Data:', data);
                
                const current = data.current_condition[0];
                const today = data.weather[0];
                
                const processedData = {
                    weather: {
                        current: {
                            condition: mapWttrWeatherCondition(current.weatherCode),
                            high: Math.round(parseFloat(today.maxtempC)),
                            low: Math.round(parseFloat(today.mintempC))
                        },
                        forecast: data.weather[0].hourly.slice(0, 4).map((hour, index) => {
                            const time = String((new Date().getHours() + index + 1) % 24).padStart(2, '0') + ':00';
                            return {
                                time: time,
                                condition: mapWttrWeatherCondition(hour.weatherCode),
                                temperature: Math.round(parseFloat(hour.tempC))
                            };
                        })
                    }
                };
                
                console.log('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏£‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', processedData);
                console.log('üìä ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:', current.temp_C, '¬∞C');
                console.log('üí® ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô:', current.humidity, '%');
                console.log('üå¨Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏•‡∏°:', current.windspeedKmph, 'km/h');
                console.log('‚è∞ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠:', new Date().toLocaleTimeString('th-TH'));
                
                return processedData;
                
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î Free Weather API:', error);
                return null;
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å API
        async function fetchRealAQIData() {
            try {
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Vercel static hosting - ‡πÉ‡∏ä‡πâ direct API calls
                // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å PHP ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô Vercel static hosting
                
                // ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Indoor AQI ‡∏à‡∏≤‡∏Å Device API
                const indoorData = await fetchIndoorAQI();
                
                // ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Outdoor AQI ‡∏à‡∏≤‡∏Å Canvas 39
                const outdoorData = await fetchCanvas39AQI();
                
                if (indoorData || outdoorData) {
                    return {
                        indoor: indoorData || {
                            aqi: 40,
                            level: "Good",
                            pollutant: "PM10", 
                            concentration: 43.5
                        },
                        outdoor: outdoorData || {
                            aqi: 84,
                            level: "Moderate",
                            pollutant: "PM2.5",
                            concentration: 27
                        }
                    };
                }
                
                return null;

            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î AQI API:', error);
                return null;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Indoor AQI
        async function fetchIndoorAQI() {
            try {
                const response = await fetch('https://device.iqair.com/v2/6790850e7307e18fb3e0c815/validated-data', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Indoor AQI API error: ${response.status}`);
                }

                const data = await response.json();
                console.log('üìä Indoor AQI Data:', data);

                // Parse response format
                if (data.current) {
                    const current = data.current;
                    const aqi = current.aqius || current.pm25?.aqius || 40;
                    
                    return {
                        aqi: aqi,
                        level: getAQILevel(aqi),
                        pollutant: "PM2.5",
                        concentration: current.pm25?.v || current.pm25?.conc || 25
                    };
                }

                return null;

            } catch (error) {
                console.log('‚ùå Indoor AQI API ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error.message);
                return null;
            }
        }

        // ‡πÅ‡∏õ‡∏•‡∏á weather code ‡∏Ç‡∏≠‡∏á wttr.in ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
        function mapWttrWeatherCondition(weatherCode) {
            const conditionMap = {
                '113': 'Sunny',         // Clear/Sunny
                '116': 'Partly Cloudy', // Partly cloudy
                '119': 'Partly Cloudy', // Cloudy
                '122': 'Partly Cloudy', // Overcast
                '143': 'Partly Cloudy', // Mist
                '176': 'Rainy',         // Patchy rain possible
                '179': 'Rainy',         // Patchy snow possible
                '182': 'Rainy',         // Patchy sleet possible
                '185': 'Rainy',         // Patchy freezing drizzle possible
                '200': 'Thunderstorm',  // Thundery outbreaks possible
                '227': 'Rainy',         // Blowing snow
                '230': 'Rainy',         // Blizzard
                '248': 'Partly Cloudy', // Fog
                '260': 'Partly Cloudy', // Freezing fog
                '263': 'Rainy',         // Patchy light drizzle
                '266': 'Rainy',         // Light drizzle
                '281': 'Rainy',         // Freezing drizzle
                '284': 'Rainy',         // Heavy freezing drizzle
                '293': 'Rainy',         // Patchy light rain
                '296': 'Rainy',         // Light rain
                '299': 'Rainy',         // Moderate rain at times
                '302': 'Rainy',         // Moderate rain
                '305': 'Rainy',         // Heavy rain at times
                '308': 'Rainy',         // Heavy rain
                '311': 'Rainy',         // Light freezing rain
                '314': 'Rainy',         // Moderate or heavy freezing rain
                '317': 'Rainy',         // Light sleet
                '320': 'Rainy',         // Moderate or heavy sleet
                '323': 'Rainy',         // Patchy light snow
                '326': 'Rainy',         // Light snow
                '329': 'Rainy',         // Patchy moderate snow
                '332': 'Rainy',         // Moderate snow
                '335': 'Rainy',         // Patchy heavy snow
                '338': 'Rainy',         // Heavy snow
                '350': 'Rainy',         // Ice pellets
                '353': 'Rainy',         // Light rain shower
                '356': 'Rainy',         // Moderate or heavy rain shower
                '359': 'Rainy',         // Torrential rain shower
                '362': 'Rainy',         // Light sleet showers
                '365': 'Rainy',         // Moderate or heavy sleet showers
                '368': 'Rainy',         // Light snow showers
                '371': 'Rainy',         // Moderate or heavy snow showers
                '374': 'Rainy',         // Light showers of ice pellets
                '377': 'Rainy',         // Moderate or heavy showers of ice pellets
                '386': 'Thunderstorm',  // Patchy light rain with thunder
                '389': 'Thunderstorm',  // Moderate or heavy rain with thunder
                '392': 'Thunderstorm',  // Patchy light snow with thunder
                '395': 'Thunderstorm'   // Moderate or heavy snow with thunder
            };
            return conditionMap[weatherCode] || 'Partly Cloudy';
        }
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á forecast ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        function generateMockForecast(currentTemp) {
            const hours = [];
            const now = new Date();
            
            for (let i = 1; i <= 4; i++) {
                const futureTime = new Date(now.getTime() + (i * 60 * 60 * 1000));
                const timeString = futureTime.toLocaleTimeString('th-TH', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
                
                // ‡∏™‡∏∏‡πà‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏à‡∏£‡∏¥‡∏á ¬±2¬∞C
                const tempVariation = (Math.random() - 0.5) * 4;
                const temperature = Math.round(currentTemp + tempVariation);
                
                // ‡∏™‡∏∏‡πà‡∏°‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
                const conditions = ['Sunny', 'Partly Cloudy', 'Rainy'];
                const condition = conditions[Math.floor(Math.random() * conditions.length)];
                
                hours.push({
                    time: timeString,
                    condition: condition,
                    temperature: temperature
                });
            }
            
            return hours;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å OpenWeatherMap
        async function fetchRealWeatherData() {
            // Allow execution even if not the primary provider (for fallback)
            if (WEATHER_API_PROVIDER !== 'openweather' && arguments[0] !== 'fallback') return null;
            
            if (WEATHER_API_KEY === 'YOUR_API_KEY_HERE') {
                console.log('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OpenWeatherMap');
                return null;
            }
            
            try {
                // Current Weather
                const currentResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${WEATHER_API_KEY}&units=metric`
                );
                
                if (!currentResponse.ok) {
                    throw new Error(`HTTP error! status: ${currentResponse.status}`);
                }
                
                const currentData = await currentResponse.json();
                
                // Forecast Weather (5 day / 3 hour)
                const forecastResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/forecast?q=${CITY}&appid=${WEATHER_API_KEY}&units=metric&cnt=4`
                );
                
                const forecastData = await forecastResponse.json();
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°
                const weatherCondition = mapWeatherCondition(currentData.weather[0].main);
                
                const processedData = {
                    weather: {
                        current: {
                            condition: weatherCondition,
                            high: Math.round(currentData.main.temp_max),
                            low: Math.round(currentData.main.temp_min)
                        },
                        forecast: forecastData.list.map(item => {
                            const time = new Date(item.dt * 1000).toLocaleTimeString('th-TH', {
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: false
                            });
                            return {
                                time: time,
                                condition: mapWeatherCondition(item.weather[0].main),
                                temperature: Math.round(item.main.temp)
                            };
                        })
                    }
                };
                
                console.log('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', processedData);
                console.log('üìä ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:', currentData.main.temp, '¬∞C');
                console.log('üå§Ô∏è ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®:', currentData.weather[0].description);
                console.log('üí® ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô:', currentData.main.humidity, '%');
                return processedData;
                
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®:', error);
                return null;
            }
        }
        
        // ‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å OpenWeatherMap ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ
        function mapWeatherCondition(openWeatherCondition) {
            const conditionMap = {
                'Clear': 'Sunny',
                'Clouds': 'Partly Cloudy',
                'Rain': 'Rainy',
                'Drizzle': 'Rainy',
                'Thunderstorm': 'Thunderstorm',
                'Snow': 'Rainy', // ‡πÉ‡∏ä‡πâ rain icon ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏¥‡∏°‡∏∞
                'Mist': 'Partly Cloudy',
                'Fog': 'Partly Cloudy'
            };
            return conditionMap[openWeatherCondition] || 'Partly Cloudy';
        }

        function getWeatherIcon(condition) {
            const iconMap = {
                'Sunny': 'sun',
                'Partly Cloudy': 'cloud',
                'Rainy': 'cloud-rain',
                'Thunderstorm': 'zap'
            };
            
            const animationClass = {
                'Sunny': 'weather-icon-sun',
                'Partly Cloudy': 'weather-icon-cloud',
                'Rainy': 'weather-icon-rain',
                'Thunderstorm': 'weather-icon-thunder'
            }[condition] || 'weather-icon-cloud';
            
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
            const colorMap = {
                'Sunny': '#FFB800',           // ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á (‡πÅ‡∏î‡∏î)
                'Partly Cloudy': '#6B7280',  // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ (‡πÄ‡∏°‡∏Ü)
                'Rainy': '#3B82F6',          // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô (‡∏ù‡∏ô)
                'Thunderstorm': '#8B5CF6'    // ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á (‡∏û‡∏≤‡∏¢‡∏∏)
            };
            
            const iconName = iconMap[condition] || 'cloud';
            const iconColor = colorMap[condition] || '#6B7280';
            
            return `<i data-feather="${iconName}" class="w-full h-full ${animationClass}" style="stroke: ${iconColor}; stroke-width: 2;"></i>`;
        }

        function updateDateTime() {
            const now = new Date();
            
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false,
                timeZone: 'Asia/Bangkok'
            });
            document.getElementById('currentTime').textContent = timeString;
            
            const dateString = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long',
                timeZone: 'Asia/Bangkok'
            });
            document.getElementById('currentDate').textContent = dateString;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        async function updateDisplay(displayConfig = null) {
            console.log('üîÑ Updating display...');
            
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å API provider ‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            let realWeatherData = null;
            
            if (WEATHER_API_PROVIDER === 'openmeteo') {
                realWeatherData = await fetchOpenMeteoWeather();
            } else if (WEATHER_API_PROVIDER === 'wttr') {
                realWeatherData = await fetchFreeWeatherData();
            } else if (WEATHER_API_PROVIDER === 'openweather') {
                realWeatherData = await fetchRealWeatherData();
            }
            
            // ‡∏ñ‡πâ‡∏≤ provider ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏•‡∏≠‡∏á fallback
            if (!realWeatherData) {
                console.log('‚ö†Ô∏è Primary weather API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏•‡∏≠‡∏á fallback...');
                
                // ‡∏•‡∏≠‡∏á OpenMeteo ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
                if (WEATHER_API_PROVIDER !== 'openmeteo') {
                    realWeatherData = await fetchOpenMeteoWeather('fallback');
                }
                
                // ‡∏•‡∏≠‡∏á wttr.in
                if (!realWeatherData && WEATHER_API_PROVIDER !== 'wttr') {
                    realWeatherData = await fetchFreeWeatherData('fallback');
                }
                
                // ‡∏•‡∏≠‡∏á OpenWeatherMap ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
                if (!realWeatherData && WEATHER_API_PROVIDER !== 'openweather') {
                    realWeatherData = await fetchRealWeatherData('fallback');
                }
            }
            
            const weather = realWeatherData ? realWeatherData.weather : mockData.weather;
            
            // ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å API
            let airQuality = mockData.airQuality;
            try {
                const realAQIData = await fetchRealAQIData();
                if (realAQIData) {
                    airQuality = realAQIData;
                    console.log('‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å API');
                } else {
                    console.log('‚ö†Ô∏è ‡πÉ‡∏ä‡πâ Mock AQI Data ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                }
            } catch (error) {
                console.log('‚ùå AQI API Error:', error.message);
                console.log('üìä ‡πÉ‡∏ä‡πâ Mock AQI Data ‡πÅ‡∏ó‡∏ô');
            }
            
            if (realWeatherData) {
                console.log('üéØ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Weather API');
            } else {
                console.log('‚ö†Ô∏è ‡πÉ‡∏ä‡πâ Mock Data ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å Weather APIs ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            }
            // Update weather elements (check if they exist)
            const lowTemp = document.getElementById('lowTemp');
            const highTemp = document.getElementById('highTemp');
            if (lowTemp) lowTemp.textContent = weather.current.low + '¬∞C';
            if (highTemp) highTemp.textContent = weather.current.high + '¬∞C';
            
            // Update today's weather icon
            const todayIconContainer = document.getElementById('todayIcon');
            if (todayIconContainer) {
                todayIconContainer.innerHTML = getWeatherIcon(weather.current.condition);
            }
            
            // Update forecast
            const forecastGrid = document.getElementById('forecastGrid');
            if (forecastGrid) {
                forecastGrid.innerHTML = '';
                
                weather.forecast.forEach(item => {
                const forecastItem = document.createElement('div');
                forecastItem.className = 'text-center flex flex-col items-center justify-center h-16 sm:h-20';
                forecastItem.innerHTML = `
                    <div class="w-8 h-8 sm:w-12 sm:h-12 mb-1">
                        ${getWeatherIcon(item.condition)}
                    </div>
                    <div class="text-lg font-medium" style="color: #3f2f15;">${item.time}</div>
                `;
                    forecastGrid.appendChild(forecastItem);
                });
            }
            
            // Update AQI
            document.getElementById('indoorAQI').textContent = airQuality.indoor.aqi;
            document.getElementById('indoorLevel').textContent = airQuality.indoor.level;
            document.getElementById('indoorPollutant').textContent = airQuality.indoor.pollutant;
            document.getElementById('indoorConcentration').textContent = airQuality.indoor.concentration;
            
            document.getElementById('outdoorAQI').textContent = airQuality.outdoor.aqi;
            document.getElementById('outdoorLevel').textContent = airQuality.outdoor.level;
            document.getElementById('outdoorPollutant').textContent = airQuality.outdoor.pollutant;
            document.getElementById('outdoorConcentration').textContent = airQuality.outdoor.concentration;
            
            // Update face icons based on AQI levels
            updateFaceIcon('indoorFace', airQuality.indoor.aqi);
            updateFaceIcon('outdoorFace', airQuality.outdoor.aqi);
            
            // Update water quality
            const waterQuality = mockData.waterQuality;
            
            // Update pool water quality elements (check if they exist)
            const poolTemp = document.getElementById('poolTemperature');
            const poolPH = document.getElementById('poolPH');
            const poolChlorine = document.getElementById('poolChlorine');
            const poolORP = document.getElementById('poolORP');
            const poolTDS = document.getElementById('poolTDS');
            
            if (poolTemp) poolTemp.textContent = waterQuality.pool.temperature || '27.5';
            if (poolPH) poolPH.textContent = waterQuality.pool.ph;
            if (poolChlorine) poolChlorine.textContent = waterQuality.pool.chlorine;
            if (poolORP) poolORP.textContent = waterQuality.pool.orp || '720';
            if (poolTDS) poolTDS.textContent = waterQuality.pool.tds || '450';
            
            // Legacy elements (may not exist in slideshow version)
            const waterPH = document.getElementById('waterPH');
            const waterChlorine = document.getElementById('waterChlorine');
            if (waterPH) waterPH.textContent = waterQuality.water.ph;
            if (waterChlorine) waterChlorine.textContent = waterQuality.water.chlorine;
            
            // Update slideshow configuration
            if (displayConfig) {
                updateSlideshowConfig(displayConfig);
            }
            
            // Reinitialize icons
            lucide.createIcons();
            feather.replace();
            
            console.log('‚úÖ Display updated successfully');
        }

        // Initialize
        // Periodically check for config updates from JSONBin.io and Firebase backup
        async function checkConfigUpdates() {
            let newConfig = null;
            
            // ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å JSONBin.io ‡∏Å‡πà‡∏≠‡∏ô (Primary)
            try {
                console.log('üîÑ Checking for config updates from JSONBin.io...');
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Access-Key': JSONBIN_CONFIG.accessKey
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    newConfig = result.record;
                    console.log('üì¶ Config checked from JSONBin.io');
                }
            } catch (error) {
                console.error('‚ùå Failed to check JSONBin.io updates:', error);
            }
            
            // ‡∏ñ‡πâ‡∏≤ JSONBin.io ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á Firebase backup
            if (!newConfig && window.firebaseDB && window.firebaseGet && window.firebaseRef) {
                try {
                    console.log('üîÑ Checking for config updates from Firebase backup...');
                    const snapshot = await window.firebaseGet(window.firebaseRef(window.firebaseDB, 'canvas39-config'));
                    
                    if (snapshot.exists()) {
                        newConfig = snapshot.val();
                        console.log('üî• Config checked from Firebase backup');
                    }
                } catch (error) {
                    console.error('‚ùå Failed to check Firebase backup updates:', error);
                }
            }
            
            // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö localStorage
            if (newConfig) {
                const cachedConfig = localStorage.getItem('canvas39_admin_config');
                if (cachedConfig) {
                    const oldConfig = JSON.parse(cachedConfig);
                    
                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (JSON.stringify(newConfig) !== JSON.stringify(oldConfig)) {
                        console.log('üÜï Config updated! Applying new configuration...');
                        
                        // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ logo ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                        const logoChanged = newConfig.images?.logo !== oldConfig.images?.logo;
                        if (logoChanged) {
                            console.log('üñºÔ∏è Logo changed detected!');
                        }
                        
                        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï localStorage
                        localStorage.setItem('canvas39_admin_config', JSON.stringify(newConfig));
                        
                        // Apply configuration ‡πÉ‡∏´‡∏°‡πà
                        applyConfig(newConfig);
                    } else {
                        console.log('‚úÖ Config is up to date');
                    }
                }
            } else {
                console.log('‚ö†Ô∏è No config source available for update check');
            }
        }

        // Slideshow functionality
        let currentSlide = 0;
        let slideInterval;
        let isTransitioning = false;
        let slideshowInitialized = false;
        let slideshowConfig = {
            enabled: true,
            interval: 10000, // 10 seconds default
            autoPlay: true,
            showAirQuality: true,
            showPoolWater: true
        };

        function showSlide(slideIndex) {
            if (isTransitioning) {
                console.log('‚è∏Ô∏è Transition in progress, skipping...');
                return;
            }
            
            console.log(`üé¨ showSlide called with index: ${slideIndex}`);
            isTransitioning = true;
            
            const slide1 = document.getElementById('slide1');
            const slide2 = document.getElementById('slide2');
            const dot1 = document.getElementById('slideDot1');
            const dot2 = document.getElementById('slideDot2');
            
            if (!slide1 || !slide2) {
                console.error('‚ùå Slide elements not found');
                isTransitioning = false;
                return;
            }
            
            // Clear all slide classes
            slide1.classList.remove('slide-active', 'slide-next', 'slide-prev');
            slide2.classList.remove('slide-active', 'slide-next', 'slide-prev');
            
            if (slideIndex === 0) {
                console.log('üì∫ Showing slide 1 (Air Quality)');
                slide1.classList.add('slide-active');
                slide2.classList.add('slide-next');
                if (dot1) {
                    dot1.classList.remove('bg-opacity-30');
                    dot1.classList.add('bg-opacity-60');
                }
                if (dot2) {
                    dot2.classList.remove('bg-opacity-60');
                    dot2.classList.add('bg-opacity-30');
                }
            } else {
                console.log('üèä‚Äç‚ôÇÔ∏è Showing slide 2 (Pool Water)');
                slide1.classList.add('slide-prev');
                slide2.classList.add('slide-active');
                if (dot2) {
                    dot2.classList.remove('bg-opacity-30');
                    dot2.classList.add('bg-opacity-60');
                }
                if (dot1) {
                    dot1.classList.remove('bg-opacity-60');
                    dot1.classList.add('bg-opacity-30');
                }
            }
            currentSlide = slideIndex;
            
            // Reset transition flag after transition completes (1000ms + buffer)
            setTimeout(() => {
                isTransitioning = false;
            }, 1200);
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % 2;
            showSlide(currentSlide);
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + 2) % 2;
            showSlide(currentSlide);
        }

        function startSlideshow() {
            if (slideInterval) {
                console.log('‚ö†Ô∏è Slideshow already running, stopping first...');
                stopSlideshow();
            }
            
            if (slideshowConfig.enabled && slideshowConfig.autoPlay) {
                slideInterval = setInterval(nextSlide, slideshowConfig.interval);
                console.log(`üé¨ Slideshow started - interval: ${slideshowConfig.interval}ms`);
            }
        }

        function stopSlideshow() {
            if (slideInterval) {
                clearInterval(slideInterval);
                slideInterval = null;
                console.log('‚è∏Ô∏è Slideshow stopped');
            }
        }

        function restartSlideshow() {
            stopSlideshow();
            startSlideshow();
        }

        function updateSlideshowConfig(config) {
            if (config.slideshow) {
                slideshowConfig.enabled = config.slideshow.enabled;
                slideshowConfig.interval = config.slideshow.interval * 1000; // Convert to milliseconds
                slideshowConfig.showAirQuality = config.slideshow.showAirQuality;
                slideshowConfig.showPoolWater = config.slideshow.showPoolWater;
                
                console.log('üé¨ Slideshow config updated:', slideshowConfig);
                
                // Restart slideshow with new settings
                restartSlideshow();
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Canvas 39 GitHub Design initializing...');
            
            // Parse and apply configuration from URL parameters, JSONBin, or localStorage
            const config = await parseConfig();
            applyConfig(config);

            // Listen for real-time config updates from admin panel
            listenForConfigUpdates();

            // Check for config updates every 30 seconds (for fallback)
            setInterval(checkConfigUpdates, 30000);
            
            updateDateTime();
            
            try {
                await updateDisplay(config);
                console.log('‚úÖ Display update completed');
            } catch (error) {
                console.error('‚ùå Error in updateDisplay:', error);
            }
            
            // Initialize slideshow only once
            if (!slideshowInitialized) {
                console.log('üé¨ Initializing slideshow...');
                
                // Check if slideshow elements exist
                const slide1 = document.getElementById('slide1');
                const slide2 = document.getElementById('slide2');
                
                if (slide1 && slide2) {
                    console.log('‚úÖ Slideshow elements found, setting up...');
                    slideshowInitialized = true;
                    showSlide(0);
                
                // Setup navigation dots
                const dot1 = document.getElementById('slideDot1');
                const dot2 = document.getElementById('slideDot2');
                
                if (dot1) {
                    dot1.addEventListener('click', () => {
                        console.log('üîò Dot 1 clicked');
                        showSlide(0);
                        // Pause slideshow briefly then restart
                        stopSlideshow();
                        setTimeout(() => {
                            startSlideshow();
                        }, 2000); // 2 second pause
                    });
                }
                
                if (dot2) {
                    dot2.addEventListener('click', () => {
                        console.log('üîò Dot 2 clicked');
                        showSlide(1);
                        // Pause slideshow briefly then restart
                        stopSlideshow();
                        setTimeout(() => {
                            startSlideshow();
                        }, 2000); // 2 second pause
                    });
                }
                
                // Start auto slideshow
                startSlideshow();
                } else {
                    console.warn('‚ùå Slideshow elements not found');
                }
            }
            
            // Fullscreen button
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å fullscreen
            const headerRight = document.createElement('div');
            headerRight.className = 'fixed top-0 right-0 w-20 h-20 z-50 cursor-pointer';
            headerRight.style.display = 'none';
            headerRight.title = 'Click to exit fullscreen';
            headerRight.addEventListener('click', function() {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                }
            });
            document.body.appendChild(headerRight);
            
            // Listen for fullscreen changes
            document.addEventListener('fullscreenchange', function() {
                const btn = document.getElementById('fullscreenBtn');
                const icon = document.getElementById('fullscreenIcon');
                
                if (document.fullscreenElement) {
                    // ‡πÄ‡∏Ç‡πâ‡∏≤ fullscreen - ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
                    btn.style.opacity = '0';
                    btn.style.pointerEvents = 'none';
                    headerRight.style.display = 'block';
                    icon.setAttribute('data-lucide', 'minimize');
                } else {
                    // ‡∏≠‡∏≠‡∏Å fullscreen - ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
                    btn.style.opacity = '1';
                    btn.style.pointerEvents = 'auto';
                    headerRight.style.display = 'none';
                    icon.setAttribute('data-lucide', 'maximize');
                }
                lucide.createIcons();
                feather.replace();
            });
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏î ESC ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å fullscreen
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.fullscreenElement) {
                    document.exitFullscreen();
                }
            });
            
            // Start clock
            setInterval(updateDateTime, 1000);
            
            // Auto-update weather data based on configured interval
            setInterval(async function() {
                console.log('üîÑ Auto-updating weather data...');
                // ‡πÉ‡∏ä‡πâ global config ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
                const savedConfig = JSON.parse(localStorage.getItem('canvas39_admin_config') || '{}');
                await updateDisplay(savedConfig);
            }, UPDATE_INTERVAL);
            
            console.log('‚úÖ GitHub Design version loaded successfully');
            
            // Initialize Feather icons
            feather.replace();
        });
    </script>
</body>
</html>