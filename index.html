<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* IQAir Exact Colors */
            --iqair-blue: #2671ae;
            --iqair-light-blue: #e8f4fd;
            --white: #ffffff;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-600: #757575;
            --gray-800: #424242;
            --gray-900: #212121;
            
            /* AQI Colors (IQAir Standard) */
            --aqi-good: #68e143;
            --aqi-moderate: #ffff55;
            --aqi-unhealthy-sensitive: #ef8533;
            --aqi-unhealthy: #ea3324;
            --aqi-very-unhealthy: #8c1a4b;
            --aqi-hazardous: #8c1a4b;
            
            /* Layout */
            --max-width: 1280px;
            --border-radius: 8px;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #000000;
            min-height: 100vh;
            color: #ffffff;
            line-height: 1.4;
            margin: 0;
            overflow: hidden;
        }

        /* AirVisual Pro Device Style */
        .device-container {
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            min-height: 100vh;
            width: 100vw;
            background: #000000;
            padding: 0;
            margin: 0;
        }

        .device-screen {
            width: 100vw;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
            max-height: 100vh;
            max-height: calc(var(--vh, 1vh) * 100);
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 0;
            border: none;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fullscreen mode */
        .device-screen:-webkit-full-screen {
            width: 100vw;
            height: 100vh;
        }

        .device-screen:-moz-full-screen {
            width: 100vw;
            height: 100vh;
        }

        .device-screen:fullscreen {
            width: 100vw;
            height: 100vh;
        }

        .device-header {
            background: rgba(255,255,255,0.05);
            padding: 24px 40px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .device-title {
            font-size: 28px;
            font-weight: 600;
            color: #ffffff;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .device-time {
            font-size: 24px;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
        }

        .fullscreen-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.9);
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .fullscreen-icon {
            font-size: 18px;
            font-weight: normal;
            display: block;
            line-height: 1;
        }

        .fullscreen-btn:hover {
            background: rgba(255,255,255,0.25);
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .fullscreen-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* ‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô tablet mode */
        @media (max-width: 1024px) and (min-width: 768px) {
            .fullscreen-btn {
                background: rgba(39, 113, 174, 0.9);
                color: #ffffff;
                animation: pulse 2s infinite;
                width: 32px;
                height: 32px;
                padding: 6px;
            }
            
            .fullscreen-icon {
                font-size: 16px;
            }
        }

        @keyframes pulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(39, 113, 174, 0.7);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 6px rgba(39, 113, 174, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(39, 113, 174, 0);
            }
        }

        /* Device Content Layout */
        .device-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 0;
            overflow: hidden;
        }

        .aqi-main-section {
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.1);
            min-height: 0;
            overflow: auto;
        }

        .details-section {
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 0;
            overflow: auto;
        }

        /* AQI Display - Device Style */
        .aqi-label-small {
            font-size: 24px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }

        /* AQI Circular Progress */
        .aqi-circle-container {
            position: relative;
            margin-bottom: 30px;
        }

        .aqi-circle {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #3a3a3a 0%, #2d2d2d 40%, #1a1a1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 0 auto;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.6),
                0 0 0 6px rgba(255,255,255,0.1),
                inset 0 4px 8px rgba(255,255,255,0.1),
                inset 0 -4px 8px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .aqi-circle::before {
            content: '';
            position: absolute;
            width: 240px;
            height: 240px;
            background: radial-gradient(circle, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .aqi-circle-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .aqi-number-large {
            font-size: 72px;
            font-weight: 400;
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 
                0 0 20px rgba(255,255,255,0.4),
                0 2px 4px rgba(0,0,0,0.3);
            color: #ffffff;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.2));
        }

        .aqi-circle-label {
            font-size: 16px;
            color: rgba(255,255,255,0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* AQI Progress Ring */
        .aqi-progress-ring {
            position: absolute;
            top: 6px;
            left: 6px;
            width: calc(100% - 12px);
            height: calc(100% - 12px);
            transform: rotate(-90deg);
            overflow: visible;
        }

        .aqi-progress-circle {
            fill: none;
            stroke-width: 10;
            stroke-linecap: butt;
            transition: all 0.8s ease-in-out;
        }

        .aqi-progress-bg {
            stroke: rgba(255,255,255,0.08);
            stroke-width: 8;
        }

        .aqi-progress-fill {
            stroke: #68e143;
            stroke-dasharray: 842;
            stroke-dashoffset: 842;
            filter: drop-shadow(0 0 8px currentColor);
            stroke-width: 10;
        }

        .aqi-status-text {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ffffff;
            text-shadow: 
                0 0 16px rgba(255,255,255,0.5),
                0 2px 4px rgba(0,0,0,0.6),
                0 0 8px currentColor;
        }

        .pm25-info {
            font-size: 18px;
            color: #ffffff;
            background: rgba(255,255,255,0.25);
            padding: 12px 24px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            font-weight: 700;
            text-shadow: 
                0 0 12px rgba(255,255,255,0.4),
                0 1px 3px rgba(0,0,0,0.5),
                0 0 6px rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.35);
            box-shadow: 
                0 4px 12px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        /* AQI Display - IQAir Big Number Style */
        .aqi-display {
            text-align: center;
            padding: 40px 24px;
            position: relative;
        }

        .aqi-number {
            font-size: 120px;
            font-weight: 300;
            line-height: 1;
            margin-bottom: 16px;
            color: var(--white);
        }

        .aqi-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--white);
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .aqi-description {
            font-size: 24px;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 16px;
        }

        .pm25-value {
            font-size: 14px;
            color: var(--white);
            opacity: 0.8;
        }

        /* AQI Colors for Device Display */
        .aqi-good .aqi-number-large,
        .aqi-good .aqi-status-text { 
            color: var(--aqi-good); 
            text-shadow: 
                0 0 20px var(--aqi-good),
                0 0 10px rgba(104, 225, 67, 0.8),
                0 2px 4px rgba(0,0,0,0.6);
        }
        
        .aqi-good .pm25-info {
            background: rgba(104, 225, 67, 0.2);
            border: 1px solid rgba(104, 225, 67, 0.4);
            color: #ffffff;
            text-shadow: 
                0 0 12px rgba(104, 225, 67, 0.6),
                0 1px 3px rgba(0,0,0,0.5);
        }
        
        .aqi-moderate .aqi-number-large,
        .aqi-moderate .aqi-status-text { color: var(--aqi-moderate); }
        
        .aqi-unhealthy-sensitive .aqi-number-large,
        .aqi-unhealthy-sensitive .aqi-status-text { color: var(--aqi-unhealthy-sensitive); }
        
        .aqi-unhealthy .aqi-number-large,
        .aqi-unhealthy .aqi-status-text { color: var(--aqi-unhealthy); }
        
        .aqi-very-unhealthy .aqi-number-large,
        .aqi-very-unhealthy .aqi-status-text { color: var(--aqi-very-unhealthy); }
        
        .aqi-hazardous .aqi-number-large,
        .aqi-hazardous .aqi-status-text { color: var(--aqi-hazardous); }

        .aqi-value {
            font-size: 4.5rem;
            font-weight: 900;
            color: var(--text-primary);
            line-height: 1;
            margin: 0;
        }

        .aqi-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .aqi-status {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .aqi-pm25 {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--background-light);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
        }

        /* Device Info Card */
        .device-info-card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 16px;
            font-size: 14px;
            color: var(--gray-600);
        }

        .device-info-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .source-badge {
            background: var(--iqair-blue);
            color: var(--white);
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .last-update {
            font-size: 12px;
            color: var(--gray-600);
        }

        /* Right Panel - IQAir Details */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Details Section - Device Style */
        .data-group {
            margin-bottom: 32px;
            flex-shrink: 0;
        }

        .data-group-title {
            font-size: 18px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 8px;
            font-weight: 600;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
            padding: 8px 0;
        }

        .data-label {
            font-size: 16px;
            color: rgba(255,255,255,0.8);
            font-weight: 500;
        }

        .data-value {
            font-size: 22px;
            font-weight: 600;
            color: #ffffff;
        }

        .data-unit {
            font-size: 14px;
            color: rgba(255,255,255,0.6);
            margin-left: 4px;
        }

        .card-icon {
            font-size: 1.8rem;
            margin-bottom: 0.75rem;
        }

        .detail-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--gray-900);
            line-height: 1;
            margin-bottom: 8px;
        }

        .detail-label {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .detail-unit {
            font-size: 12px;
            color: var(--gray-600);
        }

        /* Particles Grid */
        .particles-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .particle-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-small);
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .particle-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        .particle-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .particle-label {
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 600;
        }

        /* AQI Status Colors */
        .aqi-good {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
        }

        .aqi-moderate {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
        }

        .aqi-unhealthy {
            background: linear-gradient(135deg, #f97316, #fb923c);
            color: white;
        }

        .aqi-bad {
            background: linear-gradient(135deg, #ef4444, #f87171);
            color: white;
        }

        .aqi-hazardous {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            color: white;
        }

        /* Loading State */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(255,255,255,0.2);
            border-top: 6px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #ffffff;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .loading-subtext {
            color: rgba(255,255,255,0.7);
            font-size: 1.5rem;
            font-weight: 500;
        }

        /* Responsive Design for Tablets */
        @media (max-width: 1024px) and (min-width: 768px) {
            /* Tablet 10 inch - ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô */
            .device-header {
                padding: 8px 20px;
                flex-shrink: 0;
            }
            
            .device-title {
                font-size: 20px;
                font-weight: 700;
            }
            
            .device-time {
                font-size: 16px;
                font-weight: 600;
            }
            
            .fullscreen-btn {
                font-size: 14px;
                padding: 6px 12px;
            }
            
            .device-content {
                min-height: calc(100vh - 56px);
            }
            
            .aqi-main-section {
                padding: 20px 16px;
            }
            
            .details-section {
                padding: 20px 24px;
            }
            
            /* ‡∏ß‡∏á‡∏Å‡∏•‡∏° AQI ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
            .aqi-circle {
                width: 180px !important;
                height: 180px !important;
            }
            
            .aqi-circle::before {
                width: 155px;
                height: 155px;
            }
            
            .aqi-number-large {
                font-size: 42px !important;
                font-weight: 600 !important;
                text-shadow: 
                    0 0 20px rgba(255,255,255,0.6),
                    0 3px 6px rgba(0,0,0,0.4) !important;
            }
            
            .aqi-circle-label {
                font-size: 14px;
                font-weight: 800 !important;
                color: rgba(255,255,255,0.9) !important;
            }
            
            .aqi-label-small {
                font-size: 20px;
                margin-bottom: 16px;
                font-weight: 700 !important;
                color: rgba(255,255,255,0.95) !important;
            }
            
            .aqi-circle-container {
                margin-bottom: 20px;
            }
            
            .aqi-status-text {
                font-size: 14px;
                margin-bottom: 8px;
                font-weight: 800 !important;
                color: #ffffff !important;
                text-shadow: 0 1px 3px rgba(0,0,0,0.5) !important;
            }
            
            .pm25-info {
                font-size: 12px;
                padding: 6px 12px;
                font-weight: 700 !important;
                color: rgba(255,255,255,0.98) !important;
                background: rgba(255,255,255,0.2) !important;
            }
            
            /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ */
            .data-group {
                margin-bottom: 16px;
            }
            
            .data-group-title {
                font-size: 12px;
                margin-bottom: 8px;
                padding-bottom: 4px;
            }
            
            .data-row {
                margin-bottom: 6px;
                padding: 4px 0;
            }
            
            .data-label {
                font-size: 12px;
            }
            
            .data-value {
                font-size: 16px;
            }
            
            .data-unit {
                font-size: 11px;
            }
        }

        /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö viewport ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏ô‡πâ‡∏≠‡∏¢ (landscape tablet/mobile) */
        @media (max-height: 600px) {
            .device-header {
                padding: 4px 12px !important;
                min-height: 40px;
            }
            
            .device-title {
                font-size: 14px !important;
            }
            
            .device-time {
                font-size: 11px !important;
            }
            
            .fullscreen-btn {
                font-size: 9px !important;
                padding: 3px 6px !important;
            }
            
            .device-content {
                min-height: calc(100vh - 40px) !important;
            }
            
            .aqi-main-section {
                padding: 8px 6px !important;
            }
            
            .details-section {
                padding: 8px 12px !important;
            }
            
            /* ‡∏ß‡∏á‡∏Å‡∏•‡∏° AQI ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö landscape */
            .aqi-circle {
                width: 120px !important;
                height: 120px !important;
            }
            
            .aqi-circle::before {
                width: 105px !important;
                height: 105px !important;
            }
            
            .aqi-number-large {
                font-size: 24px !important;
            }
            
            .aqi-circle-label {
                font-size: 8px !important;
            }
            
            .aqi-label-small {
                font-size: 11px !important;
                margin-bottom: 4px !important;
            }
            
            .aqi-circle-container {
                margin-bottom: 6px !important;
            }
            
            .aqi-status-text {
                font-size: 11px !important;
                margin-bottom: 4px !important;
            }
            
            .pm25-info {
                font-size: 10px !important;
                padding: 4px 8px !important;
            }
            
            /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ compact */
            .data-group {
                margin-bottom: 10px !important;
            }
            
            .data-group-title {
                font-size: 10px !important;
                margin-bottom: 4px !important;
                padding-bottom: 2px !important;
            }
            
            .data-row {
                margin-bottom: 3px !important;
                padding: 2px 0 !important;
            }
            
            .data-label {
                font-size: 10px !important;
            }
            
            .data-value {
                font-size: 13px !important;
            }
            
            .data-unit {
                font-size: 9px !important;
            }
        }

        @media (max-width: 768px) {
            /* Mobile phones - layout stack */
            .device-content {
                grid-template-columns: 1fr;
                min-height: calc(100vh - 60px);
            }
            
            .device-header {
                padding: 8px 16px;
                flex-shrink: 0;
            }
            
            .device-title {
                font-size: 16px;
            }
            
            .device-time {
                font-size: 12px;
            }
            
            .fullscreen-btn {
                font-size: 11px;
                padding: 5px 10px;
            }
            
            .aqi-main-section {
                border-right: none;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                padding: 16px 12px;
                flex-shrink: 0;
            }
            
            .details-section {
                padding: 16px;
                flex: 1;
                overflow: auto;
            }
            
            /* ‡∏ß‡∏á‡∏Å‡∏•‡∏° AQI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mobile */
            .aqi-circle {
                width: 180px !important;
                height: 180px !important;
            }
            
            .aqi-circle::before {
                width: 155px;
                height: 155px;
            }
            
            .aqi-number-large {
                font-size: 40px !important;
            }
            
            .aqi-circle-label {
                font-size: 11px;
            }
            
            .aqi-label-small {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .aqi-circle-container {
                margin-bottom: 12px;
            }
            
            .aqi-status-text {
                font-size: 16px;
                margin-bottom: 10px;
            }
            
            .pm25-info {
                font-size: 14px;
                padding: 8px 16px;
            }
            
            /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
            .data-group {
                margin-bottom: 20px;
            }
            
            .data-group-title {
                font-size: 14px;
                margin-bottom: 12px;
            }
            
            .data-row {
                margin-bottom: 8px;
                padding: 6px 0;
            }
            
            .data-label {
                font-size: 14px;
            }
            
            .data-value {
                font-size: 18px;
            }
            
            .data-unit {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            /* Small mobile phones */
            .aqi-number-large {
                font-size: 80px;
            }
            
            .aqi-status-text {
                font-size: 20px;
            }
            
            .pm25-info {
                font-size: 14px;
            }
        }

        /* Smooth entrance animations */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .fade-in-delay-1 { animation-delay: 0.1s; }
        .fade-in-delay-2 { animation-delay: 0.2s; }
        .fade-in-delay-3 { animation-delay: 0.3s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Theme Support */
        .theme-dark {
            --bg-card: rgba(31, 41, 55, 0.9);
            --text-dark: #f9fafb;
            --text-light: #d1d5db;
        }

        .theme-light {
            --bg-glass: rgba(255, 255, 255, 0.25);
            --bg-card: rgba(255, 255, 255, 0.95);
        }

        .theme-nature {
            background: linear-gradient(135deg, #10b981 0%, #047857 100%);
        }

        .theme-sunset {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
        }

        /* Layout Modes */
        .layout-tv .container {
            max-width: 100%;
            padding: 3rem;
        }

        .layout-tv .aqi-value {
            font-size: 5rem;
        }

        .layout-tablet .container {
            max-width: 768px;
        }

        .layout-mobile .container {
            grid-template-columns: 1fr;
            max-width: 480px;
        }
    </style>
</head>
<body>
    <!-- Loading State -->
    <div id="loadingContainer" class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Data</div>
        <div class="loading-subtext">Connecting to AirVisual</div>
    </div>

    <!-- AirVisual Pro Device Display -->
    <div class="device-container" id="mainContainer" style="display: none;">
        <div class="device-screen">
            <!-- Device Header -->
            <div class="device-header">
                <div class="device-title">Canvas 39 - Bangkok</div>
                <div class="header-right">
                    <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()">
                        <span class="fullscreen-icon">‚õ∂</span>
                    </button>
                    <div class="device-time" id="currentTime">--:--</div>
                </div>
            </div>

            <!-- Device Content -->
            <div class="device-content">
                <!-- Left Section - Main AQI -->
                <div class="aqi-main-section" id="aqiMainSection">
                    <div class="aqi-label-small">US AQI</div>
                    
                    <!-- AQI Circular Progress -->
                    <div class="aqi-circle-container">
                        <div class="aqi-circle">
                            <!-- SVG Progress Ring -->
                            <svg class="aqi-progress-ring" viewBox="0 0 268 268" preserveAspectRatio="xMidYMid meet">
                                <circle class="aqi-progress-circle aqi-progress-bg" 
                                        cx="134" cy="134" r="129" />
                                <circle class="aqi-progress-circle aqi-progress-fill" 
                                        id="aqiProgressRing"
                                        cx="134" cy="134" r="129" />
                            </svg>
                            
                            <!-- Circle Content -->
                            <div class="aqi-circle-content">
                                <div class="aqi-number-large" id="aqiValue">--</div>
                                <div class="aqi-circle-label">AQI</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="aqi-status-text" id="aqiStatus">Loading...</div>
                    <div class="pm25-info" id="aqiPm25">PM2.5: -- Œºg/m¬≥</div>
                </div>

                <!-- Right Section - Details -->
                <div class="details-section">
                    <!-- Weather Data -->
                    <div class="data-group">
                        <div class="data-group-title">Weather</div>
                        <div class="data-row">
                            <span class="data-label">Temperature</span>
                            <span class="data-value" id="temperature">--<span class="data-unit">¬∞C</span></span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Humidity</span>
                            <span class="data-value" id="humidity">--<span class="data-unit">%</span></span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Pressure</span>
                            <span class="data-value" id="pressure">--<span class="data-unit">hPa</span></span>
                        </div>
                    </div>

                    <!-- Pollutants -->
                    <div class="data-group">
                        <div class="data-group-title">Pollutants</div>
                        <div class="data-row">
                            <span class="data-label">PM2.5</span>
                            <span class="data-value" id="pm25">--<span class="data-unit">Œºg/m¬≥</span></span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">PM10</span>
                            <span class="data-value" id="pm10">--<span class="data-unit">Œºg/m¬≥</span></span>
                        </div>
                    </div>

                    <!-- Device Info -->
                    <div class="data-group">
                        <div class="data-group-title">Device</div>
                        <div class="data-row">
                            <span class="data-label">Source</span>
                            <span class="data-value" id="sourceBadge">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Last Update</span>
                            <span class="data-value" id="lastUpdate" style="font-size: 12px;">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURATION ===
        let CONFIG = {
            API_ENDPOINT: './api/air-quality-multi.php',
            FALLBACK_API: './api/air-quality-dual.php',
            UPDATE_INTERVAL: 5 * 60 * 1000,
            RETRY_INTERVAL: 30 * 1000,
            MAX_RETRIES: 3,
            SOURCES: [
                {
                    type: 'station_api',
                    url: 'https://device.iqair.com/v2/6790850e7307e18fb3e0c815/validated-data',
                    priority: 1
                }
            ]
        };

        let retryCount = 0;
        let updateTimer = null;
        let lastUpdateTime = null;

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Air Quality Monitor starting system');
            initializeApp();
        });

        function initializeApp() {
            console.log('üîß Initializing app...');
            loadSettings();
            startDataUpdates();
            setupKeyboardControls();
            startClock();
            setupViewportHandling();
            
            // Add entrance animations
            setTimeout(() => {
                document.querySelectorAll('.fade-in').forEach((el, index) => {
                    el.style.animationDelay = `${index * 0.1}s`;
                });
            }, 100);
        }

        function setupViewportHandling() {
            // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏° viewport
            function handleResize() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
                
                console.log('üì± Viewport:', window.innerWidth, 'x', window.innerHeight);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö font
                adjustFontSizes();
            }
            
            function adjustFontSizes() {
                const screenHeight = window.innerHeight;
                const screenWidth = window.innerWidth;
                
                console.log(`üì± Viewport: ${screenWidth}x${screenHeight}`);
                
                // ‡πÉ‡∏ä‡πâ CSS media queries ‡πÅ‡∏ó‡∏ô JavaScript ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö responsive
                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï progress ring ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AQI ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
                
                // ‡∏´‡∏≤ AQI ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï circle
                const aqiElement = document.getElementById('aqiValue');
                if (aqiElement && aqiElement.textContent && aqiElement.textContent !== '--') {
                    const currentAQI = parseInt(aqiElement.textContent);
                    if (!isNaN(currentAQI)) {
                        updateAQICircle(currentAQI);
                        console.log(`üîÑ Refreshed AQI circle for: ${currentAQI}`);
                    }
                }
            }
            
            // ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            window.addEventListener('resize', handleResize);
            window.addEventListener('orientationchange', () => {
                setTimeout(handleResize, 100);
            });
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            handleResize();
        }

        // === SETTINGS MANAGEMENT ===
        function loadSettings() {
            try {
                const devices = JSON.parse(localStorage.getItem('air_monitor_devices') || '[]');
                const displaySettings = JSON.parse(localStorage.getItem('air_monitor_display_settings') || '{}');
                
                // Apply theme and layout
                applyDisplaySettings(displaySettings);
                
                // Get primary device
                const primaryDevice = devices.find(d => d.location === 'main') || devices[0];
                if (primaryDevice) {
                    CONFIG.UPDATE_INTERVAL = (primaryDevice.interval || 5) * 60 * 1000;
                }
                
                console.log('‚öôÔ∏è Settings loaded:', CONFIG);
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Error loading settings:', error);
            }
        }

        function applyDisplaySettings(settings) {
            const body = document.body;
            
            // Apply theme
            if (settings.theme) {
                body.className = body.className.replace(/theme-\w+/g, '');
                if (settings.theme !== 'default') {
                    body.classList.add(`theme-${settings.theme}`);
                }
            }
            
            // Apply layout
            if (settings.layout) {
                body.className = body.className.replace(/layout-\w+/g, '');
                if (settings.layout !== 'responsive') {
                    body.classList.add(`layout-${settings.layout}`);
                }
            }
        }

        // === DATA FETCHING ===
        async function fetchAirQualityData() {
            console.log('üì° Fetching air quality data from:', CONFIG.API_ENDPOINT);
            console.log('üìã Using sources:', CONFIG.SOURCES);

            try {
                // Send sources config to multi-source API
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 20000);
                
                console.log('üì§ Sending request...');
                let response = await fetch(CONFIG.API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify({
                        sources: CONFIG.SOURCES
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                console.log('üì° Response status:', response.status, response.statusText);

                if (!response.ok) {
                    console.warn('Multi-source API failed, trying fallback...');
                    const fallbackController = new AbortController();
                    const fallbackTimeoutId = setTimeout(() => fallbackController.abort(), 15000);
                    
                    response = await fetch(CONFIG.FALLBACK_API, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        },
                        signal: fallbackController.signal
                    });
                    
                    clearTimeout(fallbackTimeoutId);
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('üì• Multi-source API Response received:', {
                    success: result.success,
                    source: result.source,
                    data_source: result.data_source_detail,
                    aqi: result.data?.current?.pollution?.aqius
                });
                
                if (!result.success) {
                    throw new Error(result.message || result.error || 'API returned error');
                }

                if (result.data && result.data.current) {
                    retryCount = 0;
                    lastUpdateTime = new Date();
                    // Store source data for display
                    result.data.source_info = {
                        type: result.source,
                        detail: result.data_source_detail,
                        timestamp: result.timestamp
                    };
                    return result.data;
                } else {
                    throw new Error('Invalid data format from API');
                }
                
            } catch (error) {
                console.error('‚ùå Multi-source API Error:', error.message);
                throw error;
            }
        }

        function processAirQualityData(data) {
            try {
                console.log('üîÑ Processing multi-source air quality data');
                
                const current = data.current;
                const pollution = current.pollution;
                const weather = current.weather;
                const sourceInfo = data.source_info;

                // Update AQI with circular progress
                const aqiValue = pollution.aqius || 0;
                const aqiStatus = updateAQICircle(aqiValue);
                
                document.getElementById('aqiValue').textContent = aqiValue;
                document.getElementById('aqiStatus').textContent = aqiStatus.text;
                
                // Update PM2.5
                const pm25Value = pollution.pm25?.v || 0;
                document.getElementById('aqiPm25').textContent = `PM2.5: ${pm25Value} Œºg/m¬≥`;

                // Update Environmental Data - use available data
                document.getElementById('temperature').textContent = weather.tp || '--';
                document.getElementById('humidity').textContent = weather.hu || '--';
                document.getElementById('pressure').textContent = weather.pr || '--';
                // Wind speed is not displayed in this layout

                // Update Particles Data - use available data
                document.getElementById('pm25').textContent = pm25Value || '--';
                document.getElementById('pm10').textContent = pollution.pm10?.v || '--';
                // PM1 is not displayed in this layout

                // Update source badge
                if (sourceInfo) {
                    const sourceText = {
                        'station_api': 'STATION',
                        'station_validated_data': 'VALIDATED',
                        'public_station': 'WEB',
                        'device_api': 'DEVICE',
                        'city_api': 'CITY',
                        'demo': 'DEMO'
                    };
                    document.getElementById('sourceBadge').textContent = sourceText[sourceInfo.type] || sourceInfo.type;
                }

                // Update Last Update Time
                document.getElementById('lastUpdate').textContent = 
                    formatEnglishTime(lastUpdateTime);

                // Show main content
                showMainContent();

                console.log('‚úÖ Data updated successfully - AQI:', aqiValue, 'Source:', sourceInfo?.type);
                
            } catch (error) {
                console.error('‚ùå Error processing data:', error);
                // Don't show error, use demo data instead
                loadDemoData();
            }
        }

        function getAQIStatus(aqi) {
            if (aqi <= 50) return { 
                text: 'Good', 
                class: 'aqi-good',
                color: '#68e143',
                percentage: (aqi / 50) * 20  // 0-20% of circle
            };
            if (aqi <= 100) return { 
                text: 'Moderate', 
                class: 'aqi-moderate',
                color: '#ffff55',
                percentage: 20 + ((aqi - 50) / 50) * 20  // 20-40% of circle
            };
            if (aqi <= 150) return { 
                text: 'Unhealthy for Sensitive Groups', 
                class: 'aqi-unhealthy-sensitive',
                color: '#ef8533',
                percentage: 40 + ((aqi - 100) / 50) * 20  // 40-60% of circle
            };
            if (aqi <= 200) return { 
                text: 'Unhealthy', 
                class: 'aqi-unhealthy',
                color: '#ea3324',
                percentage: 60 + ((aqi - 150) / 50) * 20  // 60-80% of circle
            };
            if (aqi <= 300) return { 
                text: 'Very Unhealthy', 
                class: 'aqi-very-unhealthy',
                color: '#8c1a4b',
                percentage: 80 + ((aqi - 200) / 100) * 15  // 80-95% of circle
            };
            return { 
                text: 'Hazardous', 
                class: 'aqi-hazardous',
                color: '#722f37',
                percentage: Math.min(95 + ((aqi - 300) / 200) * 5, 100)  // 95-100% of circle
            };
        }

        function updateAQICircle(aqi) {
            const status = getAQIStatus(aqi);
            const progressRing = document.getElementById('aqiProgressRing');
            const aqiMainSection = document.getElementById('aqiMainSection');
            
            if (progressRing) {
                // ‡πÉ‡∏ä‡πâ radius ‡πÉ‡∏´‡∏°‡πà 129
                const radius = 129;
                const circumference = 2 * Math.PI * radius;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì percentage ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (0-100%)
                let percentage;
                if (aqi <= 300) {
                    percentage = Math.min((aqi / 300) * 100, 100);
                } else {
                    percentage = 100;
                }
                
                const offset = circumference - (percentage / 100) * circumference;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï progress ring
                progressRing.style.strokeDasharray = circumference.toFixed(2);
                progressRing.style.strokeDashoffset = offset.toFixed(2);
                progressRing.style.stroke = status.color;
                
                console.log(`üéØ AQI Circle: ${aqi} ‚Üí ${percentage.toFixed(1)}% (${status.text}) Color: ${status.color}`);
            }
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á section ‡∏ï‡∏≤‡∏° AQI
            if (aqiMainSection) {
                aqiMainSection.className = `aqi-main-section ${status.class}`;
            }
            
            return status;
        }

        // === UPDATE SYSTEM ===
        function startDataUpdates() {
            console.log('üîÑ Starting data update system');
            
            // Initial update
            updateAirQualityData();
            
            // Set up recurring updates
            if (updateTimer) clearInterval(updateTimer);
            updateTimer = setInterval(updateAirQualityData, CONFIG.UPDATE_INTERVAL);
            
            console.log(`‚è∞ Auto-update every ${CONFIG.UPDATE_INTERVAL / 60000} minutes`);
        }

        async function updateAirQualityData() {
            try {
                const data = await fetchAirQualityData();
                processAirQualityData(data);
            } catch (error) {
                console.error('‚ùå Update failed:', error);
                handleUpdateError();
            }
        }

        function handleUpdateError() {
            retryCount++;
            console.log(`üîÑ Retry ${retryCount}/${CONFIG.MAX_RETRIES}`);
            
            if (retryCount >= CONFIG.MAX_RETRIES) {
                // Try fallback API first
                console.log('‚ùå All retries failed, trying fallback API...');
                tryFallbackAPI();
            } else {
                // Retry after delay
                setTimeout(updateAirQualityData, CONFIG.RETRY_INTERVAL);
            }
        }

        async function tryFallbackAPI() {
            try {
                console.log('üîÑ Trying fallback API...');
                const response = await fetch(CONFIG.FALLBACK_API, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data) {
                        console.log('‚úÖ Fallback API successful');
                        processAirQualityData(result.data);
                        return;
                    }
                }
                
                // If everything fails, load demo data
                console.log('‚ùå All APIs failed, showing demo data');
                loadDemoData();
                
            } catch (error) {
                console.error('‚ùå Fallback API error:', error);
                console.log('‚ùå Loading demo data as last resort');
                loadDemoData();
            }
        }

        // === UI MANAGEMENT ===
        function showMainContent() {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'flex';
        }

        // === DEMO DATA FALLBACK ===
        function loadDemoData() {
            console.log('üé≠ Loading demo data');
            
            try {
                const demoData = {
                    current: {
                        pollution: {
                            aqius: 49,
                            pm25: { v: 18.3 },
                            pm10: { v: 26 },
                            pm1: { v: 13 }
                        },
                        weather: {
                            tp: 29,
                            hu: 76,
                            pr: 1011,
                            ws: 4
                        }
                    },
                    source_info: {
                        type: 'demo',
                        detail: 'demo_data',
                        timestamp: new Date().toISOString()
                    }
                };
                
                lastUpdateTime = new Date();
                
                // Force show main content first
                document.getElementById('loadingContainer').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'flex';
                
                processAirQualityData(demoData);
                
                console.log('‚úÖ Demo data loaded successfully');
                
            } catch (error) {
                console.error('‚ùå Error loading demo data:', error);
                
                // Manual fallback - directly set values
                document.getElementById('loadingContainer').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'flex';
                
                document.getElementById('aqiValue').textContent = '49';
                const demoStatus = updateAQICircle(49);
                document.getElementById('aqiStatus').textContent = demoStatus.text;
                document.getElementById('aqiPm25').textContent = 'PM2.5: 18.3 Œºg/m¬≥';
                document.getElementById('lastUpdate').textContent = formatEnglishTime(new Date());
                
                console.log('‚úÖ Manual demo data set');
            }
        }

        // === UTILITY FUNCTIONS ===
        function formatEnglishTime(date) {
            if (!date) return '--';
            
            const options = {
                hour: '2-digit',
                minute: '2-digit',
                day: 'numeric',
                month: 'short',
                timeZone: 'Asia/Bangkok'
            };
            
            return new Intl.DateTimeFormat('en-US', options).format(date);
        }

        function startClock() {
            function updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: 'Asia/Bangkok',
                    hour12: false
                });
                document.getElementById('currentTime').textContent = timeString;
            }
            
            updateClock(); // Initial update
            setInterval(updateClock, 1000); // Update every second
        }

        // === KEYBOARD CONTROLS ===
        function setupKeyboardControls() {
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        updateAirQualityData();
                        break;
                    case 'r':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            location.reload();
                        }
                        break;
                    case 'f':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            toggleFullscreen();
                        }
                        break;
                    case 'd':
                        if (e.ctrlKey && e.shiftKey) {
                            e.preventDefault();
                            loadDemoData();
                        }
                        break;
                }
            });
        }

        function toggleFullscreen() {
            const btn = document.getElementById('fullscreenBtn');
            
            if (!document.fullscreenElement) {
                // ‡πÄ‡∏Ç‡πâ‡∏≤ fullscreen
                const element = document.documentElement;
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                }
                btn.innerHTML = '<span class="fullscreen-icon">üî≤</span>';
                console.log('üñ•Ô∏è Entering fullscreen mode');
            } else {
                // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                btn.innerHTML = '<span class="fullscreen-icon">‚õ∂</span>';
                console.log('üñ•Ô∏è Exiting fullscreen mode');
            }
        }

        // ‡∏ü‡∏±‡∏á fullscreen change events
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('msfullscreenchange', handleFullscreenChange);

        function handleFullscreenChange() {
            updateFullscreenButton();
            
            // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï AQI circle ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ responsive ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
            setTimeout(() => {
                adjustFontSizes();
            }, 100);
        }

        function updateFullscreenButton() {
            const btn = document.getElementById('fullscreenBtn');
            const icon = btn.querySelector('.fullscreen-icon');
            if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                icon.textContent = '‚ßâ'; // Exit fullscreen icon (minimize)
                btn.title = 'Exit Fullscreen';
            } else {
                icon.textContent = '‚õ∂'; // Fullscreen icon (expand)
                btn.title = 'Enter Fullscreen';
            }
        }

        // === SETTINGS WATCHER ===
        window.addEventListener('storage', (e) => {
            if (e.key === 'air_monitor_display_settings') {
                console.log('üîÑ Display settings changed, reloading...');
                setTimeout(() => {
                    const settings = JSON.parse(e.newValue || '{}');
                    applyDisplaySettings(settings);
                }, 500);
            }
        });

        // === ERROR HANDLING ===
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
            // Don't show error, use demo data instead
            if (document.getElementById('mainContainer').style.display !== 'flex') {
                loadDemoData();
            }
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            // Don't show error, use demo data instead
            if (document.getElementById('mainContainer').style.display !== 'flex') {
                loadDemoData();
            }
        });

        // === AUTO-FALLBACK TO DEMO ===
        setTimeout(() => {
            if (document.getElementById('loadingContainer').style.display !== 'none') {
                console.log('‚è∞ Connection timeout, retrying API...');
                updateAirQualityData();
            }
        }, 3000); // 3 seconds timeout for debugging

        // === GLOBAL DEBUG COMMANDS ===
        window.airQualityDisplay = {
            refresh: updateAirQualityData,
            demo: loadDemoData,
            fullscreen: toggleFullscreen,
            config: CONFIG,
            status: () => ({
                lastUpdate: lastUpdateTime,
                retryCount: retryCount,
                isVisible: document.getElementById('mainContainer').style.display === 'flex'
            })
        };

        console.log('üöÄ Air Quality Display initialized');
        console.log('üíª Console commands: airQualityDisplay.refresh(), .demo(), .fullscreen()');
    </script>
</body>
</html>